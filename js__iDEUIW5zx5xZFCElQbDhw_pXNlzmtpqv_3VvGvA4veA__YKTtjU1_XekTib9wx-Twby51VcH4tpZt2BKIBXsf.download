/**
 * Makes GraphQL call and returns object of product data from shopify.
 *
 * We are using the unauthenticated "Storefront API", which works
 * differently from the other Shopify API's, in that we can't directly
 * query the variants, we can only query the parent product.
 *
 * This app in Shopify is called Inventory_Check_Unauthenticated
 * The access scope for this app is intentionally configured for the
 * retreival of unauthenticated_read_product_listings.
 * This makes it safe to have our API Token on the frontend, but we keep it in
 * an admin page to update quickly as we roll out to new locales.
 * See field "Shopify Storefront API Access Token" at /en-us/admin/ecomm-config
 *
 * @param shopifyId: string containing shopify parent product ID.
 *
 * @todo - error handling.
 * @todo - should we preload these queries in the head?
 * @todo - build out apps for other locales. (Need app development credentials).
 * @todo - Turn these utility functions into methods. (Functions in an object -
 *   this lets us do stuff like dataRefresher.getOneProductData() and then dataRefresher.updateQtyAsync)
 */
// Set the current inventory status. Defaults to 1 - if all variants are out of stock, and the Barcode(ATP) 8 weeks +, remove the buy box
var variantStatus = 1;

function getFreshProductData(shopifyId = false) {
  // Error handling if bad or no data was passed.
  if (!shopifyId || isNaN(shopifyId)) {
    console.error(
      `Bad or missing shopify ID sent to async quantity refresh: ${shopifyId}`
    );
    return false;
  }
  // Get the Storefront API token. Updated the variable name, we were pulling the wrong field.
  const storeFrontToken = Drupal.settings.igcommerce_shopifycart.shopify_storefront_api;
  // If there is no good token, the locale is probably not setup.
  if (storeFrontToken.length !== 32) {
    return false; // Return false so we can prevent trying to get fresh data on locales that are not setup.
  }
  // Get shopfiy domain.
  const shopify_domain = Drupal.settings.igcommerce_shopifycart.shopify_url;
  // Set api version. It's updated at the first of the quarter and is supported for 1 year.
  // Ex: 2021-01, 2021-04, 2021-07, 2021-10.
  let api_year = new Date().getFullYear();
  const apiVersion = `${api_year}-01`;
  // Assemble the query. (shopify_domain comes from a Drupal setting).
  const stockQuery = `https://${shopify_domain}/api/${apiVersion}/graphql.json`;

  // Shopify 'flukedev' url for testing:
  // let stockQuery = "https://flukedev.myshopify.com/api/unstable/graphql.json";
  // Shopify 'flukedev' url for testing:
  // let storeFrontToken = "5c0541e425bac22f3ff98d1436066225";

  // Resource ID's used to query StoreFront API must be base64 encoded.
  const concatProdID = String.raw`gid://shopify/Product/${shopifyId}`;
  const encoded_id = btoa(concatProdID);
  // We must use string.raw, otherwise template literals will escape
  // chars, which breaks the queries. The alternative is to wrap it
  // in JSON.Stringify - but that is an object so you can't embed variables.
  // You can see the fields we have access to here:
  // https://shopify.dev/api/storefront/2022-01/objects/ProductVariant#fields
  // cwi-6825: Added metafields to query to get Careplan type. If we want to use additional metafield tyles, we will change \"careplan\ to whatever
  // metafield we need.
  const queryBody = String.raw`{"query":"{\n  product(id: \"${encoded_id}\") {\n    id\n    title\n    variants(first:100) {\n      edges {\n        cursor\n        node {\n          id\n          title\n          barcode\n          title\n\t\t\t\t\tavailableForSale\n\t\t\t\t\tcurrentlyNotInStock\n          quantityAvailable\n\t\t\t\t\tsku\n          priceV2 {\n            amount\n            currencyCode\n          }\n compareAtPriceV2 {\n            amount\n            currencyCode\n          }\n metafield: metafield(namespace: \"my_fields\", key: \"variant_type\") {\n            value\n          }\n        }\n      }\n    }\n  }\n}\n"}`;

  // POST request will return json data.
  return fetch(stockQuery, {
    headers: {
      "Content-Type": "application/json",
      "X-Shopify-Storefront-Access-Token": storeFrontToken
    },
    method: "POST",
    body: queryBody
  })
    .then(response => response.json())
    .then(function(query_response) {
      // Quit if the product query fails.
      if (
        JSON.stringify(query_response.data.product) == null ||
        query_response === "undefined"
      ) {
        console.error("This product has no variants available");
        return;
      } else if (
        query_response.data.product.variants.edges[0].node.hasOwnProperty(
          "quantityAvailable"
        )
      ) {
        // Send back only the important stuff.
        return query_response.data.product;
      }
    });
}

/**
 * Returns object with quantity & stock status verbiabe, and stock microdata.
 *
 * This does not modify the frontend, only modifies the object.
 * If # in stock is greater than or equal to 10 display “In stock” (Available for sale & qty >= 10)
 * If # in stock is less than or equal to 9, display “In stock - only # left” (Available for sale & qty <= 9)
 * If # in stock is = 0 and the “continue selling when out of stock” is true, display “In stock” (Available for sale & qty == 0)
 * If available = 0 in Shopify and the “continue selling when out of stock” is false, display “Out of stock” (Not Available for sale & qty == 0)
 * This should not be cached and pulled real time on load with the price.
 *
 * Additional Variant Logic:
 * If available = 0 in Shopify and the “continue selling when out of stock” is false, and barcode(ATP) is 8 or more weeks, remove the variant
 * If ALL available variants are  = 0 in Shopify and the “continue selling when out of stock” is false, and barcode(ATP) is 8 or more weeks, remove the buy box entirely
 *
 * @param freshProductData: object containing parent product and model data.
 *
 * @return object organized by model name with messages and html added.
 */
function stockMessages(freshProductData = false) {
  if (!freshProductData) {
    console.error(
      "Stock message update has failed. Did you send it a product object?"
    );
  }
  // If a custom stock message is set, in_stock_message will have a variable.
  var stock_message =
    '<span class="stock-message">' + Drupal.t("In stock") + "</span>";
  if (Drupal.settings.igcommerce_shopifycart.in_stock_message) {
    stock_message = Drupal.settings.igcommerce_shopifycart.in_stock_message;
  }

  console.log("stock_message" + stock_message);
  // We need some key-value pairs, so we'll rebuild the freshProductData object.
  const all_models_cleaned_up = new Object();
  let variantStock = 0; // CWI-6624: If all variants are out of stock AND ATP is over 10 weeks, remove the buy box completely.
  let variantATP = 0; // Count the variants to see if any are over 8 weeks. If no variant in stock AND all variants are over 8 weeks, we remove buy box
  // Cycle through the models, add key names, stock message and stock microdata.
  freshProductData.variants.edges.forEach(model => {
    // Put all stock data into an array keyed by model name.
    // (The dropdown box uses these same names as the select values).
    let model_id = model.node.title;
    // Assign existing values to the new array.
    all_models_cleaned_up[model_id] = model.node;
    // Stock status logic.
    let currentATP = model.node.barcode;
    // Remove the week/day from the Barcode field so we can isolate the value
    currentATP = currentATP.replace(/[^0-9]/g, "");

    // If a variant ATP is less than 8 weeks, we still want to show the out of stock button.
    if (currentATP < 8) {
      variantATP++;
    }
    // Get the metafield, currently for Careplans. Could be used for other stuff in the future.
     all_models_cleaned_up[model_id].metaField = null;
     if (model.node.metafield != null) {
       all_models_cleaned_up[model_id].metaField = 'yes';
     }
    // Get currency code
    currencyCode = all_models_cleaned_up[model_id].priceV2.currencyCode;

    var formatter = new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: currencyCode,
    });
    all_models_cleaned_up[model_id].vanityTitle =
      model_id +
      " " +
      formatter.format(all_models_cleaned_up[model_id].priceV2.amount);
      // CWI-6749: In the rare occurance that we have a negative number of inventory (Continue selling when out of stock is checked and they sell more than we have ),
      // we also want to show `in stock`. Before it was showing "Only negative quantity left"
      if (
      (model.node.availableForSale && model.node.quantityAvailable >= 10) ||
      (model.node.availableForSale &&
        model.node.quantityAvailable <= 9 &&
        Math.sign(model.node.quantityAvailable) === -1)
    ) {
      all_models_cleaned_up[model_id].stockMessage = stock_message;
      all_models_cleaned_up[model_id].schemaAvailability = "InStock";
      all_models_cleaned_up[model_id].variantAvailability = 1; // Set the variant availability. If it is not availableForSale AND the ATP is 8 weeks or more, we want to remove the variant
      // The the ATP is 8 week or more, increment the variant ATP variable so we can track the condition to remove the buy box.
      variantStock++;
    } else if (
      model.node.availableForSale &&
      model.node.quantityAvailable === 0
    ) {
      all_models_cleaned_up[model_id].stockMessage = stock_message;
      all_models_cleaned_up[model_id].schemaAvailability = "BackOrder";
      all_models_cleaned_up[model_id].variantAvailability = 1;
    } else if (
      model.node.availableForSale &&
      model.node.quantityAvailable <= 9
    ) {
      let currentModelStockMessage = Drupal.t(
        "In stock - only @quantity left",
        { "@quantity": model.node.quantityAvailable }
      );
      all_models_cleaned_up[
        model_id
      ].stockMessage = `<span class='stock-message'>${currentModelStockMessage}</span>`;
      all_models_cleaned_up[model_id].schemaAvailability = "InStock";
      all_models_cleaned_up[model_id].variantAvailability = 1;
      variantStock++;
    } else {
      all_models_cleaned_up[
        model_id
      ].stockMessage = `<span class='stock-message'>${Drupal.t(
        "Out of stock"
      )}</span>`;
      all_models_cleaned_up[model_id].schemaAvailability = "OutOfStock";
      all_models_cleaned_up[model_id].variantAvailability = 1;
      if (!model.node.availableForSale && currentATP >= 8) {
        all_models_cleaned_up[model_id].variantAvailability = 0;
      }
    }
  });

  // If there is no variant on the product display with inventory AND all of them are over 8 weeks for delivery, remove the buy box.
  if (variantStock === 0 && variantATP === 0) {
    noneAvailable();
  }
  return all_models_cleaned_up;
}

/**
 * Updates stock message in "buy box" and adds "availability" microdata on page load.
 *
 * Adds an event listener that updates the stock message when a new variant is
 * selected.
 *
 */
function setBuyBoxStockMessages(all_models_cleaned_up = false) {
  // If all variants are out of stock, the buybox is removed. In this instance, the ID for shopify-id will be missing, so exit.
  if (variantStatus === 0) {
    console.log("All variants out of stock");
    return false;
  }
  // Grab the shopifyID from the class.
  const shopifyId = document.getElementById("shopify-id").getAttribute("class");
  // Message area in the buy box to display stock messge.
  const messageArea = document.querySelector(`#shopify-price-label .in-stock`);

  // Delivery estimate area. Replace this with estimates based on the ATP found in the barcode field.
  const deliveryArea = document.querySelector(`#delivery_date`);
  console.log(deliveryArea,'deliveryArea');
  // The dropdown select list created async by shopifycart.js
  const modelSelector = document.querySelector(
    `#product-component-${shopifyId} .buybox-select`
  );
  // If there are no product variants, then the model selector will not have been created, and will be null
  if (modelSelector) {
    // Text of the current model selected, to be used as a key.
    var currentSelection =
      modelSelector.options[modelSelector.selectedIndex].text;

    // Check the variants in the select list. If any of them are out of stock with an ATP of 8 or more week, remove the variant from the list.
    document
      .querySelector(
        `#product-component-${shopifyId} .shopify-buy__option-select-wrapper`
      )
      .addEventListener("mousemove", function() {
        // Get the text of the currently selected option.
        currentSelection =
          modelSelector.options[modelSelector.selectedIndex].text;
        const { options } = document.querySelector(".buybox-select");
        // Look at all of the options and remove them if variantAvailability is 0;
        for (var i = 0; i < options.length; i++) {
          let oosVariant = options[i].value;
          all_models_cleaned_up[oosVariant].variantAvailability;
          // If there are multiple models, add an event listener to the dropdown box to
          // update stock status message on change.
          if (all_models_cleaned_up[oosVariant].variantAvailability == 0) {
            options[i].remove();
          }
        }
      });

    document
      .querySelector(`#product-component-${shopifyId} .buybox-select`)
      .addEventListener("change", function() {
        // Get the text of the currently selected option.
        currentSelection =
          modelSelector.options[modelSelector.selectedIndex].text;
        // Use text of currently selected option as keyfield to pull stock message and update html.
        messageArea.innerHTML =
          all_models_cleaned_up[currentSelection].stockMessage;
        deliveryArea.innerHTML = deliveryEstimate(
          all_models_cleaned_up[currentSelection].barcode
        );
        // Set the variant delivery promised based on the barcode field

        deliveryEstimate(deliveryPromise);
      });
    // Update the global variables. This lets the fallback function know it doesn't
    // need to do the stock switching on product selection.
    asyncStockWatcherIsOn = true;
  } else {
    // If there are no variants in shopify, the object key we expect is: 'Default title'.
    if (all_models_cleaned_up["Default Title"]) {
      var currentSelection = "Default Title";
    } else {
      console.error(
        "Fluke Shopify error: There is a problem with the variant or default title."
      );
      return;
    }
  }
  // Set the initial stock status microdata in the schema "offer" based on first model.
  let inStockMicrodata = `<link id="new-availability" itemprop="availability" href="https://schema.org/${all_models_cleaned_up[currentSelection].schemaAvailability}" />`;
  // Set the initial inventoryLevel microdata based on the first model.
  let inventoryLevelMicrodata = `<meta content="${all_models_cleaned_up[currentSelection].quantityAvailable}" itemprop="inventoryLevel">`;
  document
    .getElementById("default-offer")
    .insertAdjacentHTML(
      "afterbegin",
      inStockMicrodata + inventoryLevelMicrodata
    );
  // Set the stock status message on first page load.
  messageArea.innerHTML = all_models_cleaned_up[currentSelection].stockMessage;

  //Set the initial delivery estimate
  let deliveryPromise = all_models_cleaned_up[currentSelection].barcode;
  deliveryArea.innerHTML = deliveryEstimate(deliveryPromise);
}

/**
 * If the variants on a product don't meet pre-set criteria, remove the buy box.
 *
 * Currently: If a product has no variants with available inventory, and all variants are 8 or more weeks out, remove the buy box.
 * The reason they want this is poor customer experiance when viewing a product that is perpetually out of stock, and a long lead time to get more.
 */
function noneAvailable(freshProductData = false) {
  const buyBox = document.getElementById("fluke-product-display-ecommerce");
  const ecmCta = document.getElementById("fluke-product-display-ctas");
  document.getElementById("fluke-product-alerts").appendChild(ecmCta);
  buyBox.remove();
  variantStatus = 0;
}

/**
 * Creates the delivery estimate for each product and variants if they exist
 *
 * EX: Arrives by Thursday, Jul 28
 * There is a field in shopify called `barcode` that is being populated from an oracle import in en-us, and can be updated manually in other locales.
 * This field expects a number and a day/week value - EX: 1 WEEK, 3 DAYS. We use this, in combination with upcoming weekends and holidays to estimate when a customer can get their product
 */
function deliveryEstimate(deliveryPromise) {
  // Split the barcode so we can get (Number) and (DAY or WEEK)
  let deliveryArray = deliveryPromise.split(" ");
  let deliveryAmount = deliveryArray[0]; // The delivery amount is amount of days/weeks. (1 WEEK / 3 DAYS)
  let deliveryMultiplier = deliveryArray[1]; // The delivery Multiplier is 5 for busines days for a week, or 1 if they are individual days
  if (deliveryMultiplier.includes("WEEK")) {
    deliveryMultiplier = 5;
  } else {
    deliveryMultiplier = 1;
  }
  // shopifyTimeInTransit is number added here en-us/admin/ecomm-config to account for the shipping method used. It's currently 2 days for 2 day air.
  const shopifyTimeInTransit =
    Drupal.settings.igcommerce_shopifycart.shopify_delivery_estimate;
  // Variable to create delivery estimate, which is: barcode * week/month + ECM time in transit field. We will add weekends and holidays to this
  let deliveryArrivesBy =
    deliveryAmount * deliveryMultiplier + +shopifyTimeInTransit;
  // The holiday array from ECM. If a holiday is in the range of delivery days, increment a day.
  let shopifyHoliday = String(Drupal.settings.igcommerce_shopifycart.shopify_holidays);

  // The timezone to calculate when the product will arrive. Currently PST due to Everett warehouse.
  const shopifyTmz =
    Drupal.settings.igcommerce_shopifycart.ecomm_shopify_timezone; // This will be the holiday array
  let estimateLabel = Drupal.t("Arrives by ");
  var estimatedDate = new Date();

  // Loop through deliveryArrivesBy to add weekends and holidays
  for (let dayCount = 0; dayCount < deliveryArrivesBy; dayCount++) {
    // Get the current day in the same format we have in ecm, xxxx-xx-xx
    let currentDate =
      estimatedDate.getFullYear() +
      "-" +
      ("0" + (estimatedDate.getMonth() + 1)).slice(-2) +
      "-" +
      ("0" + estimatedDate.getDate()).slice(-2);
    let currentHoliday = shopifyHoliday.includes(currentDate);
    // If the current day is a weekend or holiday, increment 1 day
    if (
      estimatedDate.getDay() == 6 ||
      estimatedDate.getDay() == 0 ||
      currentHoliday == true
    ) {
      deliveryArrivesBy++;
    }
    // Go to the next day and start again.
    estimatedDate.setDate(estimatedDate.getDate() + 1);
  }
  // Create the date in a format that will look the way we want on the Frontend Thursday, Jul 28
  let estimatedTime = new Date();
  estimatedTime = estimatedTime.toLocaleString("en-US", {
    timeZone: shopifyTmz,
    hour: "2-digit",
    hour12: false
  });
  // If the time is after noon PST, add a day to the estimate
  if (estimatedTime >= 12) {
    estimatedDate.setDate(estimatedDate.getDate() + 1);
  }
  estimatedDate = estimatedDate.toLocaleString("en-US", {
    timeZone: shopifyTmz,
    weekday: "long",
    month: "short",
    day: '2-digit'
  });
  return estimateLabel + "<b>" + estimatedDate + "</b>";
}

// Global variable. If all the async stock updating works as expected, this
// will be set to true, and the fallback functions will know to let this have
// prescedence.
var asyncStockWatcherIsOn = false;

// Called when the buy box is created, then updates the stock status box.
const buyBoxCreationWatcher = new MutationObserver(function(mutations_list) {
  // Checks every mutation.
  mutations_list.forEach(function(mutation) {
    // Checks every mutation that is a child node addition.
    mutation.addedNodes.forEach(function(added_node) {
      // Check if the added element is the buy button wrapper.
      if (added_node.className == "shopify-buy__btn-wrapper") {
        // Grab the shopifyID.
        const shopifyId = document
          .getElementById("shopify-id")
          .getAttribute("class");
        // Disconnect the observer as it is no longer needed.
        buyBoxCreationWatcher.disconnect();
        // Get the fresh item data. If the getFreshProductData returns false, the locale isn't set up so don't try to get freshy
        if (getFreshProductData(shopifyId) != false) {
          getFreshProductData(shopifyId)
            .then(freshyFresh =>
              // Send that product object to have the stock messages added.
              stockMessages(freshyFresh)
            )
            .then(freshStockMessage =>
              // Update the buy box.
              setBuyBoxStockMessages(freshStockMessage)
            );
        }
      }
    });
  });
});

// Called when the Careplan buy box is created.
const careplanBoxCreationWatcher = new MutationObserver(function(
  mutations_list
) {
  // Checks every mutation.
  mutations_list.forEach(function(mutation) {
    // Checks every mutation that is a child node addition.
    mutation.addedNodes.forEach(function(added_node) {
      // Check if the added element is the careplan button wrapper.
      if (added_node.className == "shopify-buy__product__variant-selectors") {
        // Grab the shopifyID.
        let shopifyId = document
          .getElementById("ecomm-careplan")
          .getAttribute("class");
        shopifyId = shopifyId.slice(0, 13); // Get only the product id
        document
          .querySelector(`#ecomm-careplan-info`)
          .addEventListener("change", function() {
            carePlanType();
          });
        // Disconnect the observer as it is no longer needed.
        careplanBoxCreationWatcher.disconnect();
        // Get the fresh item data.
        getFreshProductData(shopifyId)
          .then(freshyFresh =>
            // Send that product object to have the metafields  added.
            stockMessages(freshyFresh)
          )
          .then(freshyFresh =>
            // Send that product object to alter the radio selections and variant list
            setCareplan(freshyFresh)
          );
      }
    });
  });
});

// Get the 'buy box' node if it's on the page.
var buyBox = document.getElementById("fluke-product-display-ecommerce");
// If the buy box exists, create observer.
if (buyBox) {
  // Watch the buy box, and wait until shopifycart.js creates the buttons.
  // Send it the node to watch, and the settings for mutation observer.
  // In this case, we're watching for a "buy box" child to be added.
  buyBoxCreationWatcher.observe(
    document.getElementById("fluke-product-display-ecommerce"),
    { subtree: true, childList: true }
  );
}

// Get the 'buy box' node if it's on the page.
var careBox = document.getElementById("ecomm-careplan");
if (careBox) {
  // Also observe the careplan box if set
  careplanBoxCreationWatcher.observe(
    document.getElementById("ecomm-careplan"),
    { subtree: true, childList: true }
  );
}
// Get the currently selected careplan type
function carePlanType() {
  let type = document.querySelector('input[name="ecom_careplan"]:checked')
    .value;
}

/**
 * Updates careplan in "Care Plan Box" and sets the cta/radio buttons based on selection
 *
 * Adds an event listener that updates the radioboxes and CTA, and adds metafields from the all_models_cleaned_up
 *
 */
function setCareplan(all_models_cleaned_up = false) {
  // If all variants are out of stock, the buybox is removed. In this instance, the ID for shopify-id will be missing, so exit.
  if (variantStatus === 0) {
    return false;
  }
  // Grab the shopifyID from the class.
  // The dropdown select list created async by shopifycart.js
  const modelSelectorCare = document.querySelector(`#careplan-select`);
  // If there are no product variants, then the model selector will not have been created, and will be null
  if (modelSelectorCare) {
    // Go through the options to see what metafields we have. If we have bundles, we want to enable the bundle radio button.
    let all = ["Select a plan:"];
    let single = [];
    let bundle = [];
    for (let key in all_models_cleaned_up) {
      var planType = all_models_cleaned_up[key];
      for (var prop in planType) {
        if (!planType.hasOwnProperty(prop)) continue;
        if (planType[prop] === '["Care Plan"]') {
          single.push(key);
        }
        if (planType[prop] === '["Care Plan Bundle"]') {
          bundle.push(key);
        }
        if (prop === "metaField") {
          all.push(key);
        }
      }
    }
    // Get the radio button for each type of plan
    const NoThanks = document.getElementById("ecom_careplan_none"); // No careplan, we will have a disabled button in this case
    const planOnly = document.getElementById("ecom_careplan_only"); // Plan only - this will be the majority of plans. Only 2 bundles even exist
    const planBundle = document.getElementById("ecom_careplan_bundle"); // ii900 are the only bundles for now. @todo: when bundles are more prevelent revisit
    const careCta = document.getElementById("careplan-select-cta"); // The Careplan CTA. Disabled at the start
    // When the dropdown for careplans are changed, set the radio button based on the meta field if found
    document
      .querySelector(`#careplan-select`)
      .addEventListener("change", function() {
        let careplanValue =
          modelSelectorCare.options[modelSelectorCare.selectedIndex].value;
        let metaCheck = modelSelectorCare.selectedIndex;

        // If no meta field is found, select `no thanks` and disable the button
        if (metaCheck === 0) {
          NoThanks.checked = true;
        }
        // If the selected item is a bundle, we change the the radio button to bundle
        // @todo: An additional nice to have would be to remove the options that don't match the selected meta field.
        else if (
          metaCheck != 0 &&
          all_models_cleaned_up[careplanValue].metaField ===
            '["Care Plan Bundle"]'
        ) {
          planBundle.checked = true;
          careCta.disabled = false;
        }
        // If the selected item is a single, we change the the radio button to bundle
        // @todo: An additional nice to have would be to remove the options that don't match the selected meta field.
        else if (
          metaCheck != 0 &&
          all_models_cleaned_up[careplanValue].metaField === '["Care Plan"]'
        ) {
          planOnly.checked = true;
          careCta.disabled = false;
        }
      });
    // If you select `No thanks` When you already have a selection, disable the CTA
    document
      .querySelector(`#ecomm-careplan-info`)
      .addEventListener("change", function() {
        if (document.getElementById("ecom_careplan_none").checked) {
          modelSelectorCare.options[0].setAttribute("selected", "");
          careCta.innerHTML = "Select a plan";
          careCta.disabled = true;
        }
      });

    // There is no "price" on the front end for careplans, and they should be the label in the select list. Appending the price to the html to keep the value the same
    document
      .querySelector(`#careplan-select`)
      .addEventListener("mousemove", function() {
        // Get the text of the currently selected option.
        currentSelection =
          modelSelectorCare.options[modelSelectorCare.selectedIndex].text;
        const { options } = document.querySelector(".careplan-select");
        // Option 0 is "Select a plan", so start at 1. Compare the option text to the model id (title)
        for (var i = 1; i < options.length; i++) {
          let careVariant = options[i].value;
          all_models_cleaned_up[careVariant];
          // If the model id is in the vanity title, replace the html to add the price
          if (
            all_models_cleaned_up[careVariant].vanityTitle.includes(
              options[i].value
            )
          ) {
            options[i].innerHTML =
              all_models_cleaned_up[careVariant].vanityTitle;
          }
        }
      });

    // When the page loads, the CTA should be disabled and set to `select a plan`
    careCta.disabled = true;
    careCta.innerHTML = "Select a plan";
    modelSelectorCare.options[0].setAttribute("selected", "");
    modelSelectorCare.options[1].removeAttribute("selected");

    // If we don't have any bundles, disable the bundle (New plan) button
    if (bundle.length <= 0) {
      const bundleRadio = document.querySelector("#ecom_careplan_bundle");
      bundleRadio.disabled = true;
    }
    // Update the global variables. This lets the fallback function know it doesn't
    // need to do the stock switching on product selection.
    asyncStockWatcherIsOn = true;
  }
}

/**
 * Functions to update the price on TOCs.
 *
 * Initially this was built looking for values stored via php. Instead, we will be checking with storefront-api so the price
 * will stay in sync with the product page.
 *
 * This is built to help prevent the 2 issues below:
 * 1. Out of date prices
 * 2. Incorrect sale status (Showing comapre at price when it no longer exists)
 *
 */

/**
 * Returns object with quantity & stock status verbiabe, and stock microdata.
 *
 * This does not modify the frontend, only modifies the object.
 * If # in stock is greater than or equal to 10 display “In stock” (Available for sale & qty >= 10)
 * If # in stock is less than or equal to 9, display “In stock - only # left” (Available for sale & qty <= 9)
 * If # in stock is = 0 and the “continue selling when out of stock” is true, display “In stock” (Available for sale & qty == 0)
 * If available = 0 in Shopify and the “continue selling when out of stock” is false, display “Out of stock” (Not Available for sale & qty == 0)
 * This should not be cached and pulled real time on load with the price.
 *
 * Additional Variant Logic:
 * If available = 0 in Shopify and the “continue selling when out of stock” is false, and barcode(ATP) is 8 or more weeks, remove the variant
 * If ALL available variants are  = 0 in Shopify and the “continue selling when out of stock” is false, and barcode(ATP) is 8 or more weeks, remove the buy box entirely
 *
 * @param freshProductData: object containing parent product and model data.
 *
 * @return object organized by model name with messages and html added.
 */
function tocPrice(freshProductData = false, shopifyId) {
  if (!freshProductData) {
    console.error(
      "Stock message update has failed. Did you send it a product object?"
    );
  }
  // If a custom stock message is set, in_stock_message will have a variable.

  // We need some key-value pairs, so we'll rebuild the freshProductData object.
  const all_models_cleaned_up = new Object();

  // Cycle through the models, add key names, stock message and stock microdata.
  freshProductData.variants.edges.forEach(model => {
    // Put all stock data into an array keyed by model name.
    // (The dropdown box uses these same names as the select values).
    let model_id = model.node.title;
    // Assign existing values to the new array.
    all_models_cleaned_up[model_id] = model.node;

    if (model.node.priceV2 != null) {
      all_models_cleaned_up[model_id].priceV2 = model.node.priceV2.amount;
    }
    if (model.node.compareAtPriceV2 != null) {
      all_models_cleaned_up[model_id].compareAtPriceV2 = model.node.compareAtPriceV2.amount;
    }

    // Get currency code
    currencyCode = all_models_cleaned_up[model_id].priceV2.currencyCode;
  });

  return all_models_cleaned_up;
}

/**
 * Updates stock message in "buy box" and adds "availability" microdata on page load.
 *
 * Adds an event listener that updates the stock message when a new variant is
 * selected.
 *
 */
function setTocPrice(all_models_cleaned_up = false, tocId) {
  // If all variants are out of stock, the buybox is removed. In this instance, the ID for shopify-id will be missing, so exit.
  if (variantStatus === 0) {
    console.log("All variants out of stock");
    return false;
  }

  const tocPrice = document.querySelector(
    `.ecom-toc-${tocId} .shopify-actual-price`
  );
  const tocComparePrice = document.querySelector(
    `.ecom-toc-${tocId} .shopify-buy__product__compare-price`
  );
  // shopify-buy__product__compare-price
  let tocItemPrice = all_models_cleaned_up[Object.keys(all_models_cleaned_up)[0]].priceV2;
  let tocItemComparePrice = all_models_cleaned_up[Object.keys(all_models_cleaned_up)[0]].compareAtPriceV2;
  if (tocPrice) {
    if (tocPrice.innerHTML !== tocItemPrice){
      // Format the price based on locale string
      tocPrice.innerHTML = Number(parseFloat(tocItemPrice).toFixed(2)).toLocaleString(undefined, {
        minimumFractionDigits: 2
      });
      console.log(tocItemPrice, 'The price of ' + tocId +' was not equal to the cached version');
    }
  }
  if (tocComparePrice) {
    if (tocComparePrice.innerHTML !== tocItemComparePrice) {
      // Format the compare price based on locale string
      tocComparePrice.innerHTML = Number(parseFloat(tocItemComparePrice).toFixed(2)).toLocaleString(undefined, {
        minimumFractionDigits: 2
      });
      console.log(tocComparePrice, 'The compare price of ' + tocId + ' was not equal to the cached version');
    }
  }
}


// Called when the buy box is created, then updates the stock status box.
const tocPriceCreationWatcher = new MutationObserver(function (mutations_list) {
  // Checks every mutation.
  mutations_list.forEach(function (mutation) {
    // Checks every mutation that is a child node addition.
    mutation.addedNodes.forEach(function (added_node) {
      // We are adding a class to the price container with only the shopify id. Grab it if only numbers in classname
      if (added_node.className !== undefined && added_node.className.includes('ecom-toc-')) {
        // Grab the shopifyID.
        let shopifyId = added_node.className.substring(9);
        // Disconnect the observer as it is no longer needed.
        tocPriceCreationWatcher.disconnect();
        // Get the fresh item data. If the getFreshProductData returns false, the locale isn't set up so don't try to get freshy
        if (getFreshProductData(shopifyId) != false) {
          getFreshProductData(shopifyId)
            .then(freshyFresh =>
              // Send that product object to have the stock messages added.
              tocPrice(freshyFresh, shopifyId)
            )
            .then(freshyFresh =>
              // Update the buy box.
              setTocPrice(freshyFresh, shopifyId)
            );
        }
      }
    });
  });
});

// Get the 'buy box' node if it's on the page.
var tocPrices = document.getElementById("toc-type-products");
// If the buy box exists, create observer.
if (tocPrices) {
  // Watch the buy box, and wait until shopifycart.js creates the buttons.
  // Send it the node to watch, and the settings for mutation observer.
  // In this case, we're watching for a "buy box" child to be added.
  tocPriceCreationWatcher.observe(
    document.getElementById("toc-type-products"),
    { subtree: true, childList: true }
  );
}

;/*})'"*/
;/*})'"*/
/*!
 * Bazaarvoice bv-loader v13.13.1
 * Tue Nov 29 2022 20:32:19 GMT+0000 (Coordinated Universal Time)
 *
 * Capabilities:
 *
 *   api@0.8.2
 *   inline_ratings@2.3.4
 *   inpage_submission@3.6.7
 *   questions@0.4.1
 *   rating_summary@2.61.2
 *   ratings@0.1.23
 *   reviews@0.5.1
 *   seller_ratings@1.5.2
 *   swat-submission@4.6.6
 *
 * http://bazaarvoice.com
 *
 * Copyright 2022 Bazaarvoice. All rights reserved.
 *
 */(()=>{var e={353:(e,t,n)=>{"use strict";n.d(t,{M:()=>c});var r,o=n(788),i=n.n(o),a=n(318),s=n(920),c=function(){var e={timeout:6e4};return r||(r=new s((function(t,n){var r=a.Z.global&&a.Z.global.serverEnvironment||"prod";i().loadScript("https://".concat("prod"===r?"apps":"apps-qa",".bazaarvoice.com/analytics/bv-analytics.js"),e,(function(e){e?n(e):t()}))})))}},426:(e,t,n)=>{var r=n(422),o=r.document&&(r.document.currentScript||r.document.querySelector('script[src*="bv.js"]'));e.exports=o},612:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Tt});var r,o,i=n(690),a=n(304),s=n(318),c=n(886),u=n(422),l="ADDED",f="REMOVED",d=["data-bv-show","name"],m=[],p="",h=new WeakMap,v=function(e,t){return e.matches?e.matches(t):e.msMatchesSelector(t)},g=function(e){var t=h.get(e);t&&(t.watches.forEach((function(t){(0,t.callback)(f,e)})),t.observer.disconnect(),h.delete(e))},y=function(e){return new u.MutationObserver((function(t){t.forEach((function(t){v(e,p)?function(e,t){h.get(e).watches.forEach((function(n){(0,n.callback)("UPDATED",e,t)}))}(e,t):g(e)}))}))},b=function(e,t){var n,r=m.filter((function(t){var n=t.selector;return v(e,n)})),o=r.reduce((function(e,t){var n=t.attributes,r=void 0===n?[]:n;return e.concat(r)}),[]),i=r;h.has(e)?(n=h.get(e).observer,t&&(i=[t])):n=y(e),n.observe(e,{attributes:!0,attributeFilter:o.length?o:void 0}),h.set(e,{watches:r,observer:n}),i.forEach((function(t){(0,t.callback)(l,e)}))},w=function(e){for(var t=e.length,n=0;n<t;n++){for(var r=e[n],o=r.addedNodes,i=o.length,a=0;a<i;a++){var s=o[a];if((s.matches||s.msMatchesSelector)&&v(s,p))b(s);else if(s.querySelectorAll){var c=s.querySelectorAll(p);if(c.length>0)for(var u=0;u<c.length;u++)b(c[u])}}for(var l=r.removedNodes,f=l.length,d=0;d<f;d++){var m=l[d];if((m.matches||m.msMatchesSelector)&&v(m,p))g(m);else if(m.querySelectorAll){var h=m.querySelectorAll(p);if(h.length>0)for(var y=0;y<h.length;y++)g(h[y])}}if("attributes"===r.type){var w=r.target;(w.matches||w.msMatchesSelector)&&v(w,p)&&b(w)}}},E=function(e){var t=e.selector;m.push(e),p+=""===p?t:",".concat(t),function(e){var t=u.document.querySelectorAll(e.selector);Array.prototype.forEach.call(t,(function(t){b(t,e)}))}(e)};r=document,o={subtree:!0,childList:!0,attributes:!0,attributeFilter:d},new u.MutationObserver(w).observe(r,o);var S=n(5),k=n.n(S),T={},O={get:function(e){return T[e]}};k().call(O);E({selector:'meta[name^="'.concat("bv:",'"]'),attributes:["name","content"],callback:function(e,t){var n=t.name.replace(new RegExp("^".concat("bv:")),"");e===f?(delete T[n],delete O[n]):T[n]=t.getAttribute("content"),O.trigger("change",n)}});var _=function(){return O},C=n(920);s.Z.global={},(0,c.Z)(s.Z.global,{client:i.Z.deployment.client,dataEnvironment:i.Z.dataEnvironment,serverEnvironment:i.Z.serverEnvironment,locale:i.Z.deployment.locale,anonymous:!0,siteId:i.Z.deployment.site,virtualEnvironment:i.Z.deployment.virtualEnvironment,ponyfills:{Promise:C},SystemJS:{},meta:_()}),(0,c.Z)(s.Z.global,{loadUserSegment:(0,a.vd)()}),Object.freeze(s.Z.global);const x=s.Z.global;var N=n(388),P=n.n(N),B=n(426),j=n.n(B),A=/[,\s]\s*/,V="bvCallback",Z=function(){if(!j())return[];var e=j().getAttribute("data-bv-preload");return e?e.split(A):[]}(),R=j()&&j().getAttribute("data-bv-callback")||V,I=j()&&j().getAttribute("data-bv-display-code"),L=j()&&j().getAttribute("data-bv-hostname"),M=n(611),D=n.n(M);function q(){return q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},q.apply(this,arguments)}var U=n(422),z=D()(i.Z.domains,U.location.hostname);const F=function(e){var t=e.commonData,n=e.name,r=e.source,o=q({},t);o.locale=i.Z.deployment.locale,o.deploymentZone=i.Z.deployment.site;var a={name:n,client:i.Z.deployment.client,display:I||i.Z.displayCode,environment:i.Z.vpc,source:r,staging:"stg"===i.Z.dataEnvironment||"qa"===i.Z.vpc,anonymous:x.anonymous,brandDomain:z.get("firstPartyCookieEnabled")?z.get("domain"):"",commonData:o},s=new(P())(a);return"europe"===i.Z.piiDataRegion&&s.setEU(!0),i.Z.webAnalyticsIntegrationConfigs&&i.Z.webAnalyticsIntegrationConfigs.length&&i.Z.webAnalyticsIntegrationConfigs.forEach((function(e){s.configureSCIProvider(e.name,e)})),s};const W=F({commonData:{bvProduct:"bv-loader",bvProductVersion:i.Z.scoutVersion},name:"bv-loader",source:"bv-loader"});var $=n(64);if("undefined"!=typeof window){var H=new RegExp(i.Z.paths.root);window.addEventListener("error",(function(e){var t=e.error,n=e.filename;H.test(n)&&(W.trackError({message:t.message||t,stack:t.stack,type:"BV Loader Uncaught ".concat(t.name||"Error")}),(0,$.Z)().then((function(e){e(t)})))}))}var Q=n(916),J=void 0,K=0,X=function(e){Q.mark(e)},G=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join("_")},Y=G("BV","PERF","MARK"),ee=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];if(r.length){var i=G(t,r.shift());return e.call.apply(e,[J,i].concat(r))}var a=[],s=[],c=function(e){X(e?G(t,e):t);var n=Q.getEntriesByType("mark"),r=n[n.length-1];return a.push(r),r},u=function(e){return function(){var n=c("end");Q.measure(t);var r=Q.getEntriesByType("measure"),o=r[r.length-1];return Object.defineProperties(o,{startTime:{configurable:!0,enumerable:!0,value:e.startTime,writable:!1},duration:{configurable:!0,enumerable:!0,value:n.startTime-e.startTime,writable:!1}}),a.push(n),s.push(o),n}},l={createMark:{configurable:!0,enumerable:!0,value:e.bind(J,t)},marks:{configurable:!0,enumerable:!0,get:function(){return a}},measures:{configurable:!0,enumerable:!0,get:function(){return s}},start:{configurable:!0,enumerable:!0,value:function(){return u(c("start"))}}};return Object.defineProperties(c,l),c};const te=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return ee.call.apply(ee,[J,G(Y,e||++K)].concat(n))};var ne=n(334);function re(){return re=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},re.apply(this,arguments)}var oe=n(422),ie=function(e){return e.map((function(e){return re({},e,{value:String(e.value)})}))},ae=function(e){return Object.keys(e).map((function(t){return{name:t,value:e[t]}})).filter((function(e){return void 0!==e.value}))},se=function(e){return e&&e!==Math.floor(e)?Number(e.toFixed(2)):e},ce=function(e,t){var n={},r=t?s.Z._render.layouts[e].perfMark:s.Z[e].perfMark,o=Q.getEntriesByType("resource").filter((function(t){return!!t.name.match(ne.Z.appNameRegex(e))||!!t.name.match(ne.Z.layoutNameRegex(e))})).shift();if(r.bvShow.marks.length&&(n.bvShowProcessed=se(r.bvShow.marks[0].startTime)),r.load.measures.length&&(n.loadTime=se(r.load.measures[0].duration),n.loadStart=se(r.load.measures[0].startTime)),!t&&r.configure.measures.length&&(n.configurationTime=se(r.configuration.measures[0].duration)),r.render.measures.length&&(n.avgRender=se(r.render.measures.reduce((function(e,t){return e+t.duration}),0)/r.render.measures.length),n.render=r.render.measures.map((function(e){return se(e.duration)})),n.renderStart=r.render.measures.map((function(e){return se(e.startTime)}))),o){var i=o.fetchStart,a=o.transferSize,c=o.responseEnd,u=o.requestStart;n.fetchStart=se(i),n.responseEnd=se(c),u&&(n.transferSize=a,n.ttfb=se(i-u))}return ie(ae(n))},ue=function(){var e={},t=Q.getEntriesByType("resource"),n=Q.getEntriesByType("paint"),r={totalPageRequests:0,totalBVRequests:0,totalCachedBVResources:0,totalCachedOtherResources:0,totalCumulativeLoadTime:0,totalCumulativeBVLoadTime:0,totalActualOtherLoadTime:0,totalActualBVLoadTime:0,totalNumOfBVScripts:0,totalNumOfBVAPIRequests:0,totalNumOfBVStylesheets:0,totalNumOfBVImages:0,totalNumOfOtherBVHTTPRequests:0,totalNumOfOtherScripts:0,totalNumOfOtherStylesheets:0,totalNumOfOtherImages:0,totalNumOfOtherHTTPRequests:0,totalNumOfHTTP2Resources:0,totalNumOfHTTP2BVResources:0,pageStatus:document.readyState},o=function(t,n){var r=n.fetchStart,o=n.responseEnd,i=n.requestStart,a=n.responseStart;e["".concat(t,"-fetchStart")]&&(t="".concat(t,"(2)")),e["".concat(t,"-fetchStart")]=se(r),e["".concat(t,"-responseEnd")]=se(o),i&&(e["".concat(t,"-ttfb")]=se(a-i))};if(t.length){var i=0,a=0,c=0;t.forEach((function(t){var n=t.name,u=t.fetchStart,l=t.duration,f=t.responseEnd,d=t.transferSize,m=t.initiatorType,p=t.nextHopProtocol,h=n.toLowerCase().includes("bv")||n.toLowerCase().includes("bazaarvoice");n.toLowerCase().includes("sid.gif")||n.toLowerCase().includes("st.gif")||n.toLowerCase().includes("a.gif")||(r.totalPageRequests++,d&&(e["".concat(n,"-transferSize")]=d),f&&c++,n.toLowerCase().includes("components.js")?o("components.js",t):n.toLowerCase().includes("bv.js")?o("bv.js",t):n.match(ne.Z.renderRegex)&&(o("render.js",t),e.renderParseComplete=se(s.Z._render.perfMark.parseComplete.marks[0].startTime)),r.totalCumulativeLoadTime+=se(l),p.includes("2")&&(r.totalNumOfHTTP2Resources++,(n.includes("bv")||n.includes("bazaarvoice"))&&r.totalNumOfHTTP2BVResources++),h?(r.totalBVRequests++,"css"===m?r.totalNumOfBVStylesheets++:"script"===m?r.totalNumOfBVScripts++:"img"===m?r.totalNumOfBVImages++:"xmlhttprequest"===m||""===m?r.totalNumOfBVAPIRequests++:r.totalNumOfOtherBVHTTPRequests++):"css"===m?r.totalNumOfOtherStylesheets++:"script"===m?r.totalNumOfOtherScripts++:"img"===m?r.totalNumOfOtherImages++:r.totalNumOfOtherHTTPRequests++,h?(r.totalCumulativeBVLoadTime+=l,l<=10&&r.totalCachedBVResources++,u>a?(r.totalActualBVLoadTime+=l,a=f):f>a&&u<a&&(r.totalActualBVLoadTime+=f-a,a=f)):(l<=10&&r.totalCachedOtherResources++,u>i?(r.totalActualOtherLoadTime+=l,i=f):f>i&&u<i&&(r.totalActualOtherLoadTime+=f-i,i=f)))})),re(e,r,{totalCumulativeLoadTime:se(r.totalCumulativeLoadTime),totalCumulativeBVLoadTime:se(r.totalCumulativeBVLoadTime),totalCumulativeOtherLoadTime:se(r.totalCumulativeLoadTime-r.totalCumulativeBVLoadTime),totalActualBVLoadTime:se(r.totalActualBVLoadTime),totalActualOtherLoadTime:se(r.totalActualOtherLoadTime),totalNumOfHTTP1Resources:t.length-r.totalNumOfHTTP2Resources,totalNumOfHTTP1BVResources:r.totalBVRequests-r.totalNumOfHTTP2BVResources,percentResourcesLoaded:se(c/r.totalPageRequests*100)})}return n.length&&n.forEach((function(t){var n=t.name.split("-").map((function(e,t){return t>0?"".concat(e[0].toUpperCase()).concat(e.slice(1,e.length)):e})).join("");e[n]=se(t.startTime)})),ie(ae(e))},le=n(974),fe=n.n(le),de="bv_metrics",me=s.Z.cookie||fe(),pe=function(){return me.create(de,!0,72e5/864e5),!0},he=!!me.read(de)||!Math.floor(1e3*Math.random())&&pe();const ve=function(e,t,n,r){if(he&&t.length){pe();var o={type:"performance",name:"Display",scope:e,metrics:t};n&&(o.bvProduct=n),r&&(o.bvProductVersion=r),W.trackEvent("Diagnostic",o)}};var ge=n(423),ye={},be={},we=n.n(ge)()(Array),Ee=function(e,t){e.filter((function(e){return!e.dataset.bvReady})).forEach((function(e){var n=e.dataset.bvShow;ye[n]&&ye[n].forEach((function(r){if("spotlights"===n&&t){var o=e.parentElement;e.removeAttribute("data-bv-ready"),o.replaceChild(e.cloneNode(!1),e)}else r(e),e.dataset.bvReady=!0}))}))},Se=function(e){e.filter((function(e){return e.dataset.bvReady})).forEach((function(e){var t=e.dataset.bvShow;be[t]&&be[t].forEach((function(t){t(e),delete e.dataset.bvReady}))}))},ke=function(e,t){ye[e]||(ye[e]=[]),ye[e].push(t),function(e){return we.then((function(t){var n=document.querySelectorAll("[".concat("data-bv-show","]"));return t.prototype.filter.call(n,(function(t){return!e||t.dataset.bvShow===e}))}))}(e).then(Ee)},Te=["data-bv-product-id","data-bv-productId","data-bv-productid","data-bv-show","data-bv-subject-id"],Oe=i.Z.apps.reduce((function(e,t){var n=t.publicName;return e[t.name]=n,e}),{}),_e=Object.keys(Oe).reduce((function(e,t){return e[Oe[t]]=function(){},e}),{}),Ce=function(e,t,r){var o=e.config.name,i=Oe[o],a=r.bvShow=r.createMark("bvShow");i&&(_e[i]=function(){t()(),e.ready((function(){a.start(),ke(i,(function(t){n.g.BV&&n.g.BV.Spotlights&&"spotlights"===i&&delete n.g.BV.Spotlights,e.trigger("container_added",t)})),function(e,t){be[e]||(be[e]=[]),be[e].push(t)}(i,(function(t){e.trigger("container_removed",t)}))})),_e[i]=function(){}})},xe=function(e){e.forEach((function(e){var t=e.dataset.bvShow;_e[t]&&_e[t]()}))},Ne=n(788),Pe=n.n(Ne),Be=n(920);function je(){return je=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},je.apply(this,arguments)}var Ae=n(422),Ve=Ae.console,Ze=!1;function Re(){return function(){var e=Ae.$BV||[],t={_apiQueue:[],log:function(){Ve&&Ve.log&&Ve.log(arguments)},push:function(e){Ze||function(){if(!i.Z.isConversations&&(L&&(i.Z.legacyScoutUrl=i.Z.legacyScoutUrl.replace(/^(https?:\/\/)([^/]+)/,"$1".concat(L))),I&&(i.Z.legacyScoutUrl=i.Z.legacyScoutUrl.replace(/\/+([^/]+)\/bvapi.js/,"/".concat(I,"/bvapi.js"))),/\[HOSTNAME\]/.test(i.Z.legacyScoutUrl)||/\[DISPLAYCODE\]/.test(i.Z.legacyScoutUrl)))throw Error('Could not determine display code and hostname. Contact Bazaarvoice Support to configure your implementation, or provide explicit "data-bv-display-code" and "data-bv-hostname" attributes.');Ze=!0,Pe().loadScript(i.Z.legacyScoutUrl)}(),t._apiQueue.push(e)}},n=T.userToken||void 0;n&&t._apiQueue.push(["configure","global",{userToken:n}]),e.forEach((function(e){t.push(e)}));return["ui","configure","container","ready","SI.trackProductPageView","SI.trackGenericPageView","SI.trackTransactionPageView","SI.disable","SI.enable","SI.setDebugEnabled","SI.trackConversion","DSI.trackBVPageView","DSI.trackProduct","DSI.trackTransaction"].forEach((function(e){!function(e,n){for(var r,o=n.split("."),i=o.pop(),a=o.shift();a;)e=e[a]=e[a]||{},a=o.shift();e[i]=(r=n.replace(/\./g,"_"),function(){for(var e,n=[r],o=0,i=arguments.length;o<i;o++)n.push(arguments[o]);return"ui"!==r?t.push(n):((e=n[3]=n[3]||{}).loadedDeferred=e.loadedDeferred||new Ie,t.push(n),e.loadedDeferred.promise())})}(t,e)})),t}()}function Ie(){var e=this;this.promiseRef=new Be((function(t,n){je(e,{resolve:t,reject:n})}))}Ie.prototype.promise=function(){return this.promiseRef};var Le=n(795),Me=n.n(Le),De=n(422),qe=De.BV&&De.BV.cookieConsent?De.BV.cookieConsent:Me(),Ue="cookies",ze=_(),Fe={},We=!i.Z.cookiesOptIn,$e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:We,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";e?qe.setConsent({BVBRANDID:!0,BVBRANDSID:!0}):qe.setConsent({BVBRANDID:!1,BVBRANDSID:!1}),Fe.cookies={consent:e,source:t}},He={},Qe=function(e){if(e===Ue){var t=ze.get(Ue);void 0===t?$e():$e("true"===t.toLowerCase(),"site")}};ze.on("change",Qe);Object.defineProperty(He,Ue,{get:function(){return Fe.cookies},set:function(e){$e(e&&!0===e.consent,"manual")}});const Je=He;var Ke="color: #0b6392; font-size:1.1em; text-decoration:none; font-weight:normal;",Xe=n.g.location.hostname,Ge=D()(i.Z.domains,Xe);function Ye(){!function(e){if(!e.isValid)throw"Bazaarvoice is not configured for the domain ".concat(Xe,".")}(Ge),function(e){if(e&&e.src){var t=ne.Z.parseClient(e.src),n=t&&t.toLowerCase();if(t&&t!==n){var r=e.src.replace("/deployments/".concat(t),"/deployments/".concat(n));console.warn("%cYou are using a cased client name (%c".concat(t,"%c) in the bv.js URL.\n        Please use this URL instead: %c").concat(r,"%c.\n        For details, see the Conversations Implementation section of https://knowledge.bazaarvoice.com."),Ke,"color:black; font-size:1.1em; font-weight:bold;",Ke,"font-size:1.0em; font-weight:lighter;",Ke)}}}(j())}var et=n(424),tt=n.n(et),nt=n(920);function rt(e,t,n,r){return r.load.end(),e&&((0,$.Z)().then((function(t){t(e)})),n.processReady(e)),new nt((function(e){"interactive"===document.readyState?e():document.addEventListener("DOMContentLoaded",(function(){e()}))})).then((function(){var e;ve(t.name,(e=t.name,ce(e,!1)),t.name,t.version)}))}function ot(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return it(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return it(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function it(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var at=document.createElement("script"),st=window.navigator.userAgent.toLowerCase(),ct={noModule:"noModule"in at,isFirefox:!!~st.indexOf("firefox"),isChrome:!!~st.indexOf("chrome")};ct.isSafari=!ct.isChrome&&!!~st.indexOf("safari"),ct.doModernLoad=ct.isSafari&&ct.noModule?function(){var e=st.match(/macintosh.+mac os x (\d+)_(\d+)_\d+\)/),t=st.match(/version\/(\d+)\.\d+\.\d+ safari\/\d+\.\d+\.\d/);if(e){var n=ot(e,3),r=n[1],o=n[2];if(Number(r)>=10&&Number(o)>=13&&t){var i=ot(t,2)[1];return Number(i)>=11}return!1}return!0}():!ct.noModule&&ct.isFirefox?function(){var e=st.match(/(?:firefox\/)([\d.]+)/);if(e&&e.length){var t=ot(e,2)[1];return Number(t)>54}return!1}():ct.noModule;const ut=ct;var lt=n.g.BV,ft=function(e){return e&&e.split(",").map((function(e){return e.trim()}))||[]}(T.disabled);function dt(e,t){var r=t.createMark("register",e.name);r.end=r.start();var o=new(tt())({name:e.name});s.Z.registerProperty(e.name,o);var i=t.createMark("app",e.name),a=i.createMark("configure"),c=i.createMark("load"),u=i.createMark("render");i.configure=a,i.load=c,i.render=u,s.Z[e.name].perfMark=i,o.setErrorHandler((function(t,r){return function(e,t,r){t instanceof Error||(t=new Error(t));var o=n.g.console;o&&o.error&&o.error(t),s.Z[e]._analytics.trackError({message:t.message||t,stack:t.stack,type:"BV Application ".concat(r.event," ").concat(t.name||"Error")}),(0,$.Z)().then((function(n){r.app=e,n(t,{extra:r})}))}(e.name,t,r)}));var l=function(){var t=s.Z[e.name]._analytics=F({name:e.name,source:"bv-loader"});lt.global.loadUserSegment.then((function(e){t.setCommonData({displaySegment:e})})),"api"===e.name&&(s.Z[e.name].analytics=t),ft.some((function(t){return~[e.name,e.publicName].indexOf(t)}))?W.trackEvent("Feature",{type:"Used",name:"AppDisabled",detail1:e.name}):function(e,t,n){n.load.end=n.load.start();var r=e.sourcePath;if(e.legacyPath&&!ut.doModernLoad&&(r=e.legacyPath),Pe().loadScript(r,{timeout:6e4},(function(r){rt(r,e,t,n)})),e.configUrl){var o=n.createMark("load","config");o.end=o.start(),Pe().loadScript(e.configUrl,{timeout:3e4},(function(){o.end()}))}}(e,o,i),l=function(){}};if(Z.some((function(t){return t===e.name}))||!e.defer)l();else{var f=o.configure,d=o.ready,m=o.render,p=function(e,t){return l(),o.configure=f,o.ready=d,o.render=m,o[e].apply(this,t)};["configure","ready","render"].forEach((function(e){o[e]=function(){return p.call(this,e,arguments)}}))}Ce(o,(function(){return l}),i),r.end()}k().call(tt().prototype);const mt=function(){Me().initConsent({NoCookie:!0,bv_metrics:!1,bv_segment:!1,BVBRANDID:!1,BVBRANDSID:!1},!i.Z.cookiesOptIn),s.Z.cookieConsent=Me(),s.Z.cookie=fe()},pt="u6ju7tou9mntbab2rcyulj8nn",ht="6594-en_us",vt=5.5;var gt=n(422),yt=function(){var e,t,n,r,o=ht,i=(e=BV.global,t=e.dataEnvironment,n=e.serverEnvironment,r="".concat("qa"===n||"dev"===n?"qa.":"stg"===t?"stg.":"","api.bazaarvoice.com"),"https://".concat(r)),a="".concat(i,"/data/batch.json?"),s=pt,c="".concat(a,"passKey=").concat(s,"&apiversion=").concat(vt,"&displaycode=").concat(o);c+="&resource.q0=products&limit.q0=1",gt.fetch(c).catch((function(){}))},bt=n(353),wt=n(920);function Et(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return St(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return St(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function St(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n(183);var kt=n(422);const Tt=function(){var e=kt.document,t=te("bv_loader");mt(),Ye(),t.end=t.start();var n;kt.navigator.userAgent.indexOf("MSIE")>-1||kt.navigator.userAgent.indexOf("Trident/");if(s.Z.privacy=Je,Qe(Ue),s.Z.pixel=F({commonData:{bvProduct:"pixel"},name:"pixel",source:"bv-loader"}),i.Z.isCurationsEnabled){kt.crl8=kt.crl8=kt.crl8||{};var r=!1,o=[],a=function(){r=!0,o.forEach((function(e){e()}))};kt.crl8.ready=function(e){r?e():o.push(e)}}(i.Z.apps.forEach((function(e){return dt(e,t)})),s.Z.curations&&s.Z.curations.on("curations_loaded",a),E({selector:"[data-bv-show]",attributes:Te,callback:function(e,t){var n=[t];e===l?(xe(n),Ee(n)):e===f?Se(n):(xe(n),Se(n),Ee(n,!0))}}),kt.$BV&&"ui"in kt.$BV||i.Z.isPreview||(kt.$BV=Re()),"container"===(T.pageType||void 0)&&(i.Z.isConversations?kt.$BV.container("global",{}):kt.$BV.ui("submission_container",{})),(0,bt.M)(),R)&&(kt[R]?p(kt[R]):Object.defineProperty(kt,R,{get:function(){return n},set:function(e){n=e,p(e)}}));t.end();var c=Et(t.measures,1)[0],u=c.duration,d=c.startTime,m=d+u;try{W.trackEvent("Diagnostic",{name:"timeToRunScout",type:"Performance",startTime:d.toFixed(4),endTime:m.toFixed(4),elapsedMs:u.toFixed(4)})}catch(e){}function p(e){if("function"!=typeof e)throw Error("The BV Callback must be a function.");setTimeout((function(){e.call(null,s.Z)}))}he&&(new wt((function(t){"interactive"===e.readyState?t():e.addEventListener("DOMContentLoaded",(function(){t()}))})).then((function(){ve("page",function(){var e=oe.devicePixelRatio,t=oe.innerHeight,n=oe.innerWidth,r=oe.navigator,o={devicePixelRatio:e,screenHeight:t,screenWidth:n};r.connection&&(o.effectiveType=r.connection.effectiveType,o.downlink=r.connection.downlink);var i=Q.getEntriesByType("navigation").shift();return i&&["connectEnd","connectStart","domainLookupStart","domainLookupEnd","domComplete","domInteractive","domContentLoadedEventStart","fetchStart","loadEventEnd","requestStart","responseStart","responseEnd","secureConnectionStart"].forEach((function(e){o[e]=se(i[e])})),ie(ae(o))}()),ve("bv-loader",function(){var e={},t=Q.getEntriesByType("resource").filter((function(e){return!!e.name.match(ne.Z.bvLoaderRegex)})).shift();t&&["connectEnd","connectStart","domainLookupStart","domainLookupEnd","domComplete","domInteractive","domContentLoadedEventStart","fetchStart","loadEventEnd","requestStart","responseStart","responseEnd","secureConnectionStart"].forEach((function(n){e[n]=se(t[n])}));var n,r,o=(n="requestedApp",r=i.Z.apps.map((function(e){return e.name})),r.map((function(e){return{name:n,value:e}}))).concat(ae(e));return ie(o)}())})),window.addEventListener("unload",(function(){for(var e in ve("resources",ue()),kt.BV._render.layouts)ve("render",ce(e,!0),e)})));var h=t.createMark("prefetchBatchApiMark").start();yt(),h()}},690:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r={deployment:{client:"Fluke",site:"main_site",environment:"production",locale:"en_US"},dataEnvironment:"prod",serverEnvironment:"prod",vpc:"prod",piiDataRegion:"unitedStates",cookiesOptIn:!1,displayCode:"6594",domains:[{firstPartyCookieEnabled:!0,domain:".fluke.com"},{firstPartyCookieEnabled:!0,domain:".bazaarvoice.com"},{firstPartyCookieEnabled:!0,domain:".jon-testing-igcommerce.pantheonsite.io"},{firstPartyCookieEnabled:!0,domain:".dev-igcommerce.pantheonsite.io"},{firstPartyCookieEnabled:!0,domain:".live-igcommerce.pantheonsite.io"},{firstPartyCookieEnabled:!0,domain:".solrpublish-igcommerce.pantheonsite.io"},{firstPartyCookieEnabled:!0,domain:".test-igcommerce.pantheonsite.io"},{firstPartyCookieEnabled:!0,domain:".pantheonsite.io"},{firstPartyCookieEnabled:!0,domain:".theme2-igcommerce.pantheonsite.io"},{firstPartyCookieEnabled:!0,domain:".igcommerce-theme2.dd"},{firstPartyCookieEnabled:!0,domain:".theme-igcommerce.flukedev.com"},{firstPartyCookieEnabled:!0,domain:".igcommerce.lndo.site"},{firstPartyCookieEnabled:!0,domain:".theme-fluke-ecm.flukedev.com"},{firstPartyCookieEnabled:!0,domain:".flukeecm.lndo.site"},{firstPartyCookieEnabled:!0,domain:".dev-fluke-ecm.pantheonsite.io"},{firstPartyCookieEnabled:!0,domain:".test-fluke-ecm.pantheonsite.io"},{firstPartyCookieEnabled:!0,domain:".live-fluke-ecm.pantheonsite.io"},{firstPartyCookieEnabled:!0,domain:".mig4282-igcommerce.flukedev.com"},{firstPartyCookieEnabled:!0,domain:".flukedev.com"},{firstPartyCookieEnabled:!0,domain:"translate.googleusercontent.com"},{firstPartyCookieEnabled:!0,domain:"webcache.googleusercontent.com"},{firstPartyCookieEnabled:!0,domain:"translate.baiducontent.com"},{firstPartyCookieEnabled:!0,domain:".bazaarvoice.com"},{firstPartyCookieEnabled:!0,domain:"localhost"}],scoutVersion:"13.13.1",splitTestingEnabled:!1,isConversations:!0,isPreview:!1,legacyScoutUrl:"https://display.ugc.bazaarvoice.com/static/Fluke/main_site/en_US/bvapi.js",paths:{root:"https://apps.bazaarvoice.com",splitTests:"https://apps.bazaarvoice.com/splitTests.json",componentTemplate:"https://apps.bazaarvoice.com/components/components-<%= version %>.min.js",renderTemplate:"https://apps.bazaarvoice.com/render/render-<%= version %>.min.js",layoutRoot:"https://apps.bazaarvoice.com/deployments/fluke/main_site/production/en_US/layouts"},render:{},webAnalyticsIntegrationConfigs:[{name:"GoogleAnalytics",tracker:""}],apps:[{name:"api",version:"0.8.2",defer:!1,hasConfig:!0,sourcePath:"https://apps.bazaarvoice.com/apps/api/api-0.8.2.js",legacyPath:null,publicName:"api",configUrl:"https://apps.bazaarvoice.com/deployments/fluke/main_site/production/en_US/api-config.js"},{name:"inline_ratings",version:"2.3.4",defer:!0,hasConfig:!0,sourcePath:"https://apps.bazaarvoice.com/apps/inline_ratings/inline_ratings-2.3.4.js",legacyPath:null,publicName:"inline_rating",configUrl:"https://apps.bazaarvoice.com/deployments/fluke/main_site/production/en_US/inline_ratings-config.js"},{name:"inpage_submission",version:"3.6.7",defer:!0,hasConfig:!0,sourcePath:"https://apps.bazaarvoice.com/apps/inpage_submission/inpage_submission-3.6.7.js",legacyPath:null,publicName:"inpage_submission",configUrl:"https://apps.bazaarvoice.com/deployments/fluke/main_site/production/en_US/inpage_submission-config.js"},{name:"questions",version:"0.4.1",defer:!0,hasConfig:!0,sourcePath:"https://apps.bazaarvoice.com/apps/questions/questions-0.4.1.js",legacyPath:null,publicName:"questions",configUrl:"https://apps.bazaarvoice.com/deployments/fluke/main_site/production/en_US/questions-config.js"},{name:"rating_summary",version:"2.61.2",defer:!0,hasConfig:!0,sourcePath:"https://apps.bazaarvoice.com/apps/rating_summary/rating_summary-2.61.2.js",legacyPath:null,publicName:"rating_summary",configUrl:"https://apps.bazaarvoice.com/deployments/fluke/main_site/production/en_US/rating_summary-config.js"},{name:"ratings",version:"0.1.23",defer:!0,hasConfig:!0,sourcePath:"https://apps.bazaarvoice.com/apps/ratings/ratings-0.1.23.js",legacyPath:null,publicName:"ratings",configUrl:"https://apps.bazaarvoice.com/deployments/fluke/main_site/production/en_US/ratings-config.js"},{name:"reviews",version:"0.5.1",defer:!0,hasConfig:!0,sourcePath:"https://apps.bazaarvoice.com/apps/reviews/reviews-0.5.1.js",legacyPath:null,publicName:"reviews",configUrl:"https://apps.bazaarvoice.com/deployments/fluke/main_site/production/en_US/reviews-config.js"},{name:"seller_ratings",version:"1.5.2",defer:!0,hasConfig:!0,sourcePath:"https://apps.bazaarvoice.com/apps/seller_ratings/seller_ratings-1.5.2.js",legacyPath:null,publicName:"seller_ratings",configUrl:"https://apps.bazaarvoice.com/deployments/fluke/main_site/production/en_US/seller_ratings-config.js"},{name:"swat-submission",version:"4.6.6",defer:!0,hasConfig:!0,sourcePath:"https://apps.bazaarvoice.com/apps/swat-submission/swat-submission-4.6.6.js",legacyPath:null,publicName:"multi_submission",configUrl:"https://apps.bazaarvoice.com/deployments/fluke/main_site/production/en_US/swat-submission-config.js"}]}},318:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(530),o=n.n(r),i=n(690),a=n(422),s=console.warn.bind(console),c=["API_BASE_URL","Date","_bvapijs","_internal","_options","_staticAssetRegistry","configure","cookie","cookieConsent","define","easyXDM","extensions","global","initialData","name","options","performance","pixel","privacy","_private","registerProperty","_render","requestAnimationFrame","require","requirejs","serverRender","_spotlightsConfig","Spotlights","staticAssetLoader","ud","ui"].concat(i.Z.apps.map((function(e){return e.name})));if("Proxy"in a){var u=a.Proxy;a.BV=new u(a.BV||{},{set:function(e,t,n){return~c.indexOf(t)||s("Unexpected property '".concat(t,"' assigned to window.BV. Valid assignment to the BV variable requires approval from the BV Loader Team.")),e[t]=n,!0}})}const l=o().namespace("BV")},334:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(690),o=new RegExp("/deployments/([^/]+)/(?:[^/]+/){3}bv\\.js");const i={appNameRegex:function(e){return new RegExp("".concat(r.Z.paths.root,"/apps/").concat(e,"/").concat(e,"-[^/]+.js"))},layoutNameRegex:function(e){return new RegExp("".concat(r.Z.paths.layoutRoot,"/").concat(e,".json"))},renderRegex:r.Z.deployment.local?new RegExp("render.js"):new RegExp("".concat(r.Z.paths.root,"/render/render-[^/]+.js")),bvLoaderRegex:o,parseClient:function(e){var t=o.exec(e);if(t)return t[1]},errorReportPath:"".concat(r.Z.paths.root,"/errors"),errorReportProxy:"https://observability".concat("prod"===r.Z.serverEnvironment?".prod":".qa",".bazaarvoice.com/error")}},183:(e,t,n)=>{"use strict";n.r(t);var r=n(318),o=n(886),i=n(64);r.Z._private={},(0,o.Z)(r.Z._private,{ponyfills:r.Z.global.ponyfills,SystemJS:r.Z.global.SystemJS,loadUserSegment:r.Z.global.loadUserSegment,errorReporter:i.Z}),Object.freeze(r.Z._private)},64:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(753),o=n.n(r),i=n(690),a=n(390),s=n(304),c=n(334),u=n(353);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}var f=n(920),d=n(147).i8,m=n(422),p=["inpage_submission","swat_reviews","swat_questions"];function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.extra,r=t.renderVersion,o=t.componentsVersion,i=t.component,a=(0,u.M)().then((function(){return v(e,{extra:n,renderVersion:r,componentsVersion:o,component:i})})).catch((function(){return v(e,{extra:n,renderVersion:r,componentsVersion:o,component:i})}));return a.then((function(e){return g(e)}))}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.extra,r=t.renderVersion,o=t.componentsVersion,c=t.component,u=y(e),l={timestamp:new Date(Date.now()).toISOString(),logger:"bv.js",platform:"javascript",sdk:{name:"bv-loader",version:d},level:"error",release:d,tags:{components_release:o,bv_loader_release:d,render_release:r,client:i.Z.deployment.client,deployment_zone:i.Z.deployment.site,data_environment:i.Z.dataEnvironment,locale:i.Z.deployment.locale,component:c,load_id:m.BVA?m.BVA.loadId:void 0},environment:i.Z.serverEnvironment,exception:u,extra:n},f=(0,a.detect)();return f&&(l.contexts={browser:{name:f.name,version:f.version}}),(0,s.vd)().then((function(e){Object.defineProperty(l.tags,"bv_segment",{value:e})})).then((function(){return l}))}function g(e){var t,n=new XMLHttpRequest,r=(t=e.extra?e.extra.app:"",!!p.includes(t));return new f((function(t,o){var i;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE)if(200===n.status){var e;try{e=JSON.parse(n.responseText)}catch(e){o("Unable to JSON.parse server response: ".concat(n.responseText,"."))}t(e)}else o("The call to the server was not successful.")},n.open("POST",r?c.Z.errorReportProxy:c.Z.errorReportPath),n.timeout=1e4,n.ontimeout=function(){n.abort()},n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(e,(i=new WeakSet,function(e,t){if("object"===l(t)&&null!==t){if(i.has(t))return;i.add(t)}return t})))}))}function y(e){var t=function(e){var t;try{t=o().parse(e)}catch(e){return}return{frames:t.map((function(e){return{filename:e.fileName,function:e.functionName,lineno:e.lineNumber,colno:e.columnNumber}}))}}(e);return{type:e.name,value:e.message,stacktrace:t}}const b=function(){return new f((function(e){e(h)}))}},886:(e,t,n)=>{"use strict";function r(e,t){Object.keys(t).forEach((function(n){void 0!==t[n]&&Object.defineProperty(e,n,{value:t[n]})}))}n.d(t,{Z:()=>r})},304:(e,t,n)=>{"use strict";n.d(t,{vd:()=>w});var r=n(974),o=n.n(r),i=n(318),a=n(690),s=n(920),c=new Map;var u=n(920);function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d=n(422),m=864e5,p=5184e6,h="bv_segment",v=Math.random(),g=i.Z.cookie||o();function y(){return function(e){var t=c.get(e);if(t)return t;var n=new XMLHttpRequest;return t=new s((function(t,r){n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE)if(200===n.status){var e;try{e=JSON.parse(n.responseText)}catch(e){r("Unable to JSON.parse server response: ".concat(n.responseText,"."))}t(e)}else r("The call to the server was not successful.")},n.open("GET",e,!0),n.timeout=1e4,n.ontimeout=function(){n.abort()},n.send()})),c.set(e,t),t}(a.Z.paths.splitTests).then((function(e){return e.tests}),(function(){return[]}))}function b(e){var t,n=[],r=[];try{e.forEach((function(e){var t;(t=e,new Date(t.start).getTime()+(t.duration||p)<Date.now()||t.forceExpire)?r.push(e):n.push(e)}));var o=n.filter((function(e){var t=e.clients,n=e.deploymentzones;if(!t)return!1;if(n){var r=-1!==n.indexOf(i.Z.global.siteId),o=-1!==t.indexOf(i.Z.global.client);return r&&o}return-1!==t.indexOf(i.Z.global.client)})),a=n.filter((function(e){return!e.clients})),s=o.length>0?o:a;s.sort((function(e,t){return new Date(e.start)-new Date(t.start)})),t=s.shift(),r.length>0&&!t&&(r.sort((function(e,t){return new Date(t.start)-new Date(e.start)})),(t=r.shift()).inActive=!0)}catch(e){throw new Error("Something went wrong when choosing a split test.\n      Please ensure that all defined tests are valid. ".concat(e))}return t}function w(){if(!a.Z.splitTestingEnabled)return u.resolve(E());var e,t=(e="bv_segment",d.location.search.substring(1).split("&").filter((function(t){return t.split("=")[0]===e})).map((function(e){return e.split("=")[1]}))[0]);if(t)return u.resolve(t);var n=g.read(h);if(n){var r;try{r=JSON.parse(n)}catch(e){}if(r){var o=r.segment;if(o){var i=u.resolve(o);return i.then((function(){return e=r.testId,void y().then((function(t){var n=l(t.filter((function(t){return t.id===e})),1)[0];n&&n.forceExpire&&g.remove(h)}));var e})),i}}}return y().then(b).then((function(e){if(!e)return E();if(e&&e.inActive)return E(e);var t=E(e),n=new Date(e.start).getTime();if(!(n<=Date.now()))return t;var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12096e5,n=Date.now()-e;return(t-n)/m}(n,e.duration);if(r>0){var o=e.id,i=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=0,r=Object.keys(e).sort();r.length;){var o=r.pop(),i=e[o];if(v<=n+i)return o;n+=i}return t}(e.splits,t),a=JSON.stringify({testId:o,segment:i});return g.create(h,a,r),i||t}}))}function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.baseline?e.baseline:"baseline"}},388:function(e,t){var n,r,o;r=[],n=function(){function e(e){if(!(e=e||{}).name||"string"!=typeof e.name)throw new TypeError("config.name is required and must be string");this.name=e.name,this.commonData=e.commonData||{},this._verify(),this.q.push(["create",e]);for(var t,n,r=["Staging","Audience","Anonymous"],o=0;o<r.length;o++)((n=e[(t=r[o]).toLowerCase()])||e.hasOwnProperty(t.toLowerCase()))&&this["set"+t](n);e.validationCallback&&this.enableValidation(e.validationCallback),!1===e.timing&&this.disableTiming(),e.brandDomain&&this.setBrandDomain(e.brandDomain),e.eventClassFilter&&this.setEventClassFilter(e.eventClassFilter)}return function(){function t(){for(var e=n(arguments),t=1;t<e.length;t++)if(null!==e[t]&&"object"==typeof e[t])for(var r in e[t])e[t].hasOwnProperty(r)&&(e[0][r]=e[t][r]);return e[0]}function n(e){return Array.prototype.slice.call(e)}function r(e,t,n){var r,o,i=t||250;return function(){var t=n||this,a=+new Date,s=arguments;r&&a<r+i?(clearTimeout(o),o=setTimeout((function(){r=a,e.apply(t,s)}),i)):(r=a,e.apply(t,s))}}var o=["setClient","setDisplay","setAnonymous","setBrandDomain","setSource","setEnvironment","setAudience","setStaging","setEventClassFilter","setEU"],i={};function a(e){return function(){this._verify();var t=n(arguments);t.unshift(e),t.push(this.name),this.q.push(t)}}for(var s,c=0;c<o.length;c++)i[s=o[c]]=a(s);t(i,{_verify:function(){window._bvaq=window._bvaq||[],this.q=window._bvaq},_flushBatch:r((function(){this._verify(),this.q.push(["flushBatch",this.name])})),loadScript:function(e){var t=e||"latest",n=document.createElement("script");n.type="text/javascript",n.async=!0;var r="http:";"https:"===window.location.protocol&&(r="https:");var o="analytics-static.ugc.bazaarvoice.com";n.src=r+"//"+o+"/prod/static/"+t+"/bv-analytics.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(n,i)},setCommonData:function(e){t(this.commonData,e)},configureSCIProvider:function(e,t){this._verify(),this.q.push(["configureSCIProvider",e,t,this.name])},enableValidation:function(e){this._verify(),this.q.push(["enableValidation",e,this.name])},disableValidation:function(){this._verify(),this.q.push(["disableValidation",this.name])},enableTiming:function(){this._verify(),this.q.push(["enableTiming",this.name])},disableTiming:function(){this._verify(),this.q.push(["disableTiming",this.name])},addMeta:function(e,t){this._verify(),this.q.push(["addMeta",e,t,this.name])},removeMeta:function(e){this._verify(),this.q.push(["removeMeta",e,this.name])},trackEvent:function(e,n){this._verify(),this.q.push(["addBatchItem",e,t({},this.commonData,n),this.name]),this._flushBatch()},trackPageView:function(e){this._verify(),this.q.push(["trackPageView",t({},this.commonData,e),this.name])},trackError:function(e){this._verify(),this.q.push(["trackEvent","Error",t({},this.commonData,e),this.name])},trackConversion:function(e){this._verify(),this.q.push(["trackConversion",t({},this.commonData,e),this.name])},trackTransaction:function(e){this._verify(),this.q.push(["trackTransaction",t({},this.commonData,e),this.name])},trackImpression:function(e){this._verify(),this.trackEvent("Impression",t({},this.commonData,e),this.name)},doNotTrack:function(e){this._verify(),this.q.push(["doNotTrack",e,this.name])}}),t(e.prototype,i),function(){var n,r=[],o=0,i=250;function a(e,n){if(!(e=t({minPixels:100,minTime:5e3},e)).containerId)throw new Error("No containerId specified.");e.observerId=o++;var i=function(t){c(e.observerId),n(t)};return e.callback=i,r.push(e),s(),e.observerId}function s(){var e="number"==typeof n;r.length>=1&&!e?n=setInterval(d,i):0===r.length&&e&&(clearInterval(n),n=null)}function c(e){for(var t=0;t<r.length;t++)r[t].observerId===e&&(r.splice(t,1),s())}function u(){var e=window.document&&window.document.documentElement;return{height:window.innerHeight||e.clientHeight,width:window.innerWidth||e.clientWidth}}function l(e){var t,n=e.getBoundingClientRect(),r=u().height;return n.top<=0?(t=Math.max(n.top+n.height,0),t=Math.min(t,r)):n.top>=r?0:Math.min(r-n.top,n.height)}function f(e){var t,n=e.getBoundingClientRect(),r=u().width;return n.left<=0?(t=Math.max(n.left+n.width,0),t=Math.min(t,r)):n.left>=r?0:Math.min(r-n.left,n.width)}function d(){for(var e,t,n,o=0;o<r.length;o++)n=r[o],e=document.getElementById(n.containerId),t=+new Date,e?f(e)<=0||l(e)<n.minPixels?delete n.inViewAt:n.inViewAt?t-n.inViewAt>n.minTime&&n.callback():(n.inViewAt=t,0===n.minTime&&n.callback()):delete n.inViewAt}function m(e){this.id=e}m.prototype.remove=function(){c(this.id)},e.prototype.trackEventWhenVisible=function(e,n){var r=this;if(!e||"string"!=typeof e.cl)throw new TypeError("data.cl must exist and be a string");return new m(a(n,(function(){var n=t({},r.commonData,e);r.trackEvent(n.cl,n)})))},e.prototype.trackInView=function(e,n){var r=this;return new m(a(n=t({},n,{minTime:0}),(function(){var n=t({},r.commonData,e,{name:"InView",type:"Used",interaction:"0"});r.trackEvent("Feature",n)})))},e.prototype.trackViewedCGC=function(e,n){var r=this;return new m(a(n,(function(){var n=t({},r.commonData,e,{name:"ViewedUGC",type:"Used",interaction:"1"});r.trackEvent("Feature",n)})))}}()}(),e},void 0===(o="function"==typeof n?n.apply(t,r):n)||(e.exports=o)},424:(e,t,n)=>{var r=n(920);function o(e,t,n){if("function"!=typeof t)throw new Error("A function must be provided to process the queue");var r=e.length;function o(){var r=e.shift();n?t(r):setTimeout((function(){t(r)}),0)}for(;e.length>0;)o();return r}function i(e){return this.config=e,this._readyQueue=[],this._renderQueue=[],this._configQueue=[],this._promise=new r(function(e,t){this._resolve=e,this._reject=t}.bind(this)),this}i.prototype.ready=function(e){return"function"==typeof e&&this._readyQueue.push(e),this._promise},i.prototype.render=function(e){return this._renderQueue.push(e)},i.prototype.configure=function(e){return this._configQueue.push(e)};var a=function(e,t){"function"==typeof t&&t(e,this)};i.prototype.processReady=function(e){var t=a.bind(this,e);o.call(this,this._readyQueue,t,!0),this._readyQueue.push=t,this.ready=function(e){return t(e),this._promise},e?this._reject(e):this._resolve(this)},i.prototype.processQueue=function(e){o.call(this,this._renderQueue,e),this.render=this._renderQueue.push=e},i.prototype.processConfig=function(e){o.call(this,this._configQueue,e,!0),this.configure=this._configQueue.push=e},e.exports=i},974:(e,t,n)=>{var r=n(422),o=n(795),i={};function a(e,t,n,o,i){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3);var s=n?";expires="+a.toGMTString():"",c=encodeURIComponent(e)+"="+encodeURIComponent(t)+s+";path=/"+(o?";domain="+o:"")+(i?";secure":"");r.document.cookie=c}function s(e,t){delete i[e],t?a(e,null,-1,t):a(e,"",-1)}e.exports={create:function(e,t,n,r,c){i[e]=t,o.getConsent(e)&&a(e,t,n,r,c),o.subscribe(e,"add",(function(o){o?a(e,t,n,r,c):s(e,r)})),o.subscribe(e,"enable",(function(){a(e,t,n,r,c)})),o.subscribe(e,"disable",(function(){s(e,r)}))},read:function(e){var t,n=encodeURIComponent(e)+"=",o=r.document.cookie.split(";");for(t=0;t<o.length;t++){for(var i=o[t];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(n))return decodeURIComponent(i.substring(n.length,i.length))}return null},remove:s}},795:e=>{var t=function(){var e=!1,t=!0,n={},r={},o=["add","enable","disable","change"],i={};function a(e,t,n){r[e]&&r[e][t]&&Object.values(r[e][t]).forEach((function(e){e(n)}))}function s(){Object.values(i).length>0&&Object.values(i).forEach((function(e){e(Object.assign({},n))}))}function c(e,t){if("boolean"!=typeof t)throw new TypeError("cookieConsent (setConsent): consent values should be of type boolean. Check value for "+e+".");var r=n[e];r!==t&&(n[e]=t,void 0===r&&a(e,"add",t),!0===r?(a(e,"disable",t),a(e,"change",t)):!1===r?(a(e,"enable",t),a(e,"change",t)):a(e,"change",t))}function u(){r[this.consentKey]&&r[this.consentKey][this.eventName]&&delete r[this.consentKey][this.eventName][this.key]}function l(){i[this.key]&&delete i[this.key]}return{initConsent:function(r,o){if(!e){if(t=!!o)return e=!0,!0;if(!r||Array.isArray(r)||"object"!=typeof r)throw new TypeError("cookieConsent (init): consent should be an object.");for(var i=Object.keys(r),a=0;a<i.length;a++)if("boolean"!=typeof r[i[a]])throw new TypeError("cookieConsent (init): consent values for "+i[a]+" should be of type boolean.");return n=Object.assign({},r),e=!0,!0}return!1},getConsent:function(e){return!!t||n[e]},getConsentDisabled:function(){return t},setConsent:function(n){if(e&&!t){if(!n||Array.isArray(n)||"object"!=typeof n)throw new TypeError("cookieConsent (setConsent): consent should be an object.");for(var r,o=Object.keys(n),i=0;i<o.length;i++)c(o[i],n[o[i]]);var a=Object.assign({},r);return JSON.stringify(a)!==JSON.stringify(r)&&s(),!0}return!1},subscribe:function(e,t,n){if("string"!=typeof e)throw new TypeError("cookieConsent (subscribe): consent key should be of type string.");if("string"!=typeof t)throw new TypeError("cookieConsent (subscribe): event name should be of type string.");if(!o.includes(t))throw new TypeError("cookieConsent (subscribe): event name should be one of "+o.join(", ")+".");if("function"!=typeof n)throw new TypeError("cookieConsent (subscribe): callback should be a function.");r[e]||(r[e]={}),r[e][t]||(r[e][t]={});var i=Math.random().toString(36).substr(2,5);return r[e][t][i]=n,{unsubscribe:u.bind({consentKey:e,eventName:t,key:i})}},subscribeToConsentStore:function(e){if("function"!=typeof e)throw new TypeError("cookieConsent (subscribeToConsentStore): callback should be a function.");var t=Math.random().toString(36).substr(2,5);return i[t]=e,{unsubscribe:l.bind({key:t})}}}}();e.exports=t},411:(e,t,n)=>{var r=n(422).Date,o=r&&r.now,i="function"==typeof o;function a(){return o.call(r)}function s(){return(new r).getTime()}e.exports={now:function(){return(i?a:s)()}}},611:e=>{function t(e,t){if(e&&"."===e.charAt(0)&&t){var n=("."+t).lastIndexOf(e);return n>=0&&n===1+t.length-e.length}return t===e||t==="www."+e}e.exports=function(e,n){var r={},o={isValid:!1,get:function(e){return r[e]}},i=function(e,n){for(var r=0;r<e.length;r++)if(t(e[r].domain,n))return e[r]}(e,n);if(i){for(var a in o.isValid=!0,i)i.hasOwnProperty(a)&&(r[a]=i[a]);r.domain.match(/^(\.\d+){4}$/)&&(r.domain=r.domain.substr(1))}return o}},5:(e,t,n)=>{var r=Array.prototype,o=r.indexOf,i=r.slice;function a(e){n.g.console.error(e)}function s(e){this.eventErrorHandler=e}function c(e,t){var n,r,o=this.events=this.events||{},i=e.split(/\s+/),a=i.length;for(n=0;n<a;n++)o[r=i[n]]=o[r]||[],o[r].push(t);return this}function u(e,t){var n=function(){this.off(e,n),t.apply(this,i.call(arguments))};return this.on(e,n),this}function l(e,t){var n,r,o,i,a,s=this.events;if(s){for(r=0,i=(a=e.split(/\s+/)).length;r<i;r++)(n=a[r])in s!=!1&&-1!==(o=t?d(s[n],t):0)&&s[n].splice(o,1);return this}}function f(e){var t,n,r=this.events;if(r&&e in r!=!1){for(t=i.call(arguments,1),n=r[e].length-1;n>=0;n--)try{r[e][n].apply(this,t)}catch(n){(this.eventErrorHandler||a).call(this,n,{event:e,data:t})}return this}}function d(e,t){var n,r;if(o&&e.indexOf===o)return e.indexOf(t);for(n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}e.exports=function(){return this.on=c,this.off=l,this.trigger=this.emit=f,this.one=this.once=u,this.setErrorHandler=s,this}},423:(e,t,n)=>{var r,o=n(920),i=n(10),a={},s=/function\s+([^\(\s]+)/;e.exports=function(e){return new o((function(t){i((function(){var n=e.name;n||(n=s.exec(e.toString())[1]),r||((r=document.createElement("iframe")).src="about:blank",r.style.display="none",r.height="0",r.width="0",r.tabIndex="-1",r.title="empty",r.className="hidden",document.body.appendChild(r)),a[n]||(a[n]=r.contentWindow[n]),t(a[n])}))}))}},422:(e,t,n)=>{"use strict";e.exports=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof window)return window;if("undefined"!=typeof self)return self;if(void 0!==n.g)return n.g;throw new Error("unable to locate global object")}()},788:(e,t,n)=>{var r=n(422),o=n(530),i=r.document,a={};function s(){return i.getElementsByTagName("script")[0]}function c(e){return!e||"loaded"===e||"complete"===e||"uninitialized"===e}function u(e,t,n){if(!e||"string"!=typeof e)throw new Error("`url` must be a string");if(t.namespaceName&&"string"!=typeof t.namespaceName)throw new Error("`options.namespaceName` must be a string");if(t.forceLoad&&"boolean"!=typeof t.forceLoad)throw new Error("`options.forceLoad` must be a boolean");if("number"!=typeof t.timeout)throw new Error("`options.timeout` must be a number");if(n&&"function"!=typeof n)throw new Error("`callback` must be a function")}e.exports={_clearLoadedUrls:function(e){e?o.namespace(e).loadedUrls={}:a={}},loadScript:function(e,t,n){var r,l=a;if("function"==typeof t&&(n=t,t=null),(t=t||{}).timeout=t.timeout||1e4,u(e,t,n),t.namespaceName&&(r=o.namespace(t.namespaceName),l=r.loadedUrls||{}),t.forceLoad||!l[e]){var f,d=i.createElement("script"),m=!1;if(t.attributes)for(f in t.attributes)d.setAttribute(f,t.attributes[f]);d.onreadystatechange=d.onload=function(){!m&&c(d.readyState)&&h()},d.onerror=function(){m||h(new Error("Error: could not load "+e))};var p=setTimeout((function(){m||h(new Error("Error: script timeout "+e))}),t.timeout);setTimeout((function(){d.src=e;var t=s();t.parentNode.insertBefore(d,t)}),0)}else"function"==typeof n&&n();function h(o){m=!0,clearTimeout(p),d.onload=d.onreadystatechange=d.onerror=null,d.parentNode.removeChild(d),o||(l[e]=!0,t.namespaceName?r.loadedUrls=l:a=l),"function"==typeof n&&n(o)}},loadStyleSheet:function(e,t,n){var l,f=a;if("function"==typeof t&&(n=t,t=null),(t=t||{}).timeout=t.timeout||1e4,u(e,t,n),"injectionNode"in t&&!(t.injectionNode instanceof r.Element))throw new Error("`options.injectionNode` must be a DOM node");if(t.namespaceName&&(l=o.namespace(t.namespaceName),f=l.loadedUrls||{}),t.forceLoad||!f[e]){var d,m=i.createElement("link"),p=!1;if(t.attributes)for(d in t.attributes)m.setAttribute(d,t.attributes[d]);m.onreadystatechange=m.onload=function(){!p&&c(m.readyState)&&v()},m.onerror=function(){p||v(new Error("Error: could not load "+e))};var h=setTimeout(m.onerror,t.timeout);setTimeout((function(){m.media="only x",m.rel="stylesheet",m.type="text/css",m.href=e,setTimeout((function(){m.media="all"}),0);var n=t.injectionNode||s().parentNode;try{n.appendChild(m)}catch(e){v(new Error("Error: could not append LINK element"))}}),0)}else"function"==typeof n&&n();function v(r){p=!0,clearTimeout(h),m.onload=m.onreadystatechange=m.onerror=null,r||(f[e]=!0,t.namespaceName?l.loadedUrls=f:a=f),"function"==typeof n&&n(r)}}}},530:(e,t,n)=>{var r=n(422);function o(e){this.name=e}o.prototype.registerProperty=function(e,t){if(this.hasOwnProperty(e))throw new Error("Cannot register "+e+" because a property with that name already exists on window."+this.name);return this[e]=t,this},e.exports={namespace:function(e){if(void 0===r[e])Object.defineProperty(r,e,{value:new o(e)});else{if("object"!=typeof r[e])throw new Error("Namespace "+e+" cannot be created. A non-object variable is already assigned to window."+e);if(!(r[e]instanceof o))for(var t in o.call(r[e],e),o.prototype)r[e][t]=o.prototype[t]}return r[e]}}},921:e=>{e.exports={timeline:[]}},453:(e,t,n)=>{var r=n(422),o=n(921).timeline,i=r.performance,a=i&&i.getEntries,s="function"==typeof a;function c(){return a.call(i)}function u(){return o}e.exports={getEntries:function(){return(s?c:u)()}}},966:(e,t,n)=>{var r=n(422),o=n(453).getEntries,i=r.performance,a=i&&i.getEntriesByName,s="function"==typeof a;function c(e,t){return a.call(i,e,t)}function u(e,t){if(0===arguments.length)throw new TypeError("Failed to execute 'getEntriesByName' on 'Performance': 1 argument required, but only 0 present.");return o().filter((function(n){if(n.name===e&&(void 0===t||n.entryType===t))return n}))}e.exports={getEntriesByName:function(e,t){var n=arguments.length>0,r=s?c:u;return n?r(e,t):r()}}},197:(e,t,n)=>{var r=n(422),o=n(453).getEntries,i=r.performance,a=i&&i.getEntriesByType,s="function"==typeof a;function c(e){return a.call(i,e)}function u(e){if(0===arguments.length)throw new TypeError("Failed to execute 'getEntriesByType' on 'Performance': 1 argument required, but only 0 present.");return o().filter((function(t){return t.entryType===e}))}e.exports={getEntriesByType:function(e){var t=arguments.length>0,n=s?c:u;return t?n(e):n()}}},916:(e,t,n)=>{e.exports.getEntries=n(453).getEntries,e.exports.getEntriesByName=n(966).getEntriesByName,e.exports.getEntriesByType=n(197).getEntriesByType,e.exports.now=n(755).now,e.exports.mark=n(202).mark,e.exports.measure=n(165).measure},202:(e,t,n)=>{var r=n(422),o=n(755),i=n(921).timeline,a=r.performance,s=a&&a.mark,c="function"==typeof s,u={navigationStart:1,unloadEventStart:1,unloadEventEnd:1,redirectStart:1,redirectEnd:1,fetchStart:1,domainLookupStart:1,domainLookupEnd:1,connectStart:1,connectEnd:1,secureConnectionStart:1,requestStart:1,responseStart:1,responseEnd:1,domLoading:1,domInteractive:1,domContentLoadedEventStart:1,domContentLoadedEventEnd:1,domComplete:1,loadEventStart:1,loadEventEnd:1};function l(e){return s.call(a,e)}function f(e){if(arguments.length<1)throw new SyntaxError("Cannot set mark without a name");if(e in u)throw new SyntaxError('Cannot set mark with reserved name "'+e+'"');var t={entryType:"mark",name:e,startTime:o.now(),duration:0};i.push(t)}e.exports={mark:function(e){var t=arguments.length>0,n=c?l:f;return t?n(e):n()}}},165:(e,t,n)=>{var r=n(422),o=n(755).now,i=n(197).getEntriesByType,a=n(921).timeline,s=r.performance,c=s&&s.measure,u="function"==typeof c;function l(e,t,n){return void 0===t?c.call(s,e):void 0===n?c.call(s,e,t):c.call(s,e,t,n)}function f(e,t,n){if(arguments.length<1)throw new TypeError("Failed to execute 'measure' on 'Performance': 1 argument required, but only 0 present.");var r,s=i("mark"),c=0,u=o();if(void 0!==t){if(!(r=s.filter((function(e){return e.entryName===t}))).length)throw new Error("Failed to execute 'measure' on 'Performance': The mark '"+t+"' does not exist.");c=r[r.length-1].startTime}if(void 0!==n){if(!(r=s.filter((function(e){return e.entryName===n}))).length)throw new Error("Failed to execute 'measure' on 'Performance': The mark '"+n+"' does not exist.");u=r[r.length-1].startTime}var l={entryType:"measure",name:e,startTime:c,duration:u-c};a.push(l)}e.exports={measure:function(e,t,n){var r=arguments.length>0,o=u?l:f;return r?o(e,t,n):o()}}},755:(e,t,n)=>{var r=n(422),o=n(411),i=r.performance,a=i&&i.now,s="function"==typeof a,c=o.now();function u(){return a.call(i)}function l(){return o.now()-c}i&&i.timing&&"number"==typeof i.timing.navigationStart&&(c=i.timing.navigationStart),e.exports={now:function(){return(s?u:l)()}}},920:(e,t,n)=>{var r=n(422);if(void 0!==r.Promise&&r.Promise.toString().match(/\[native code]/))e.exports=r.Promise;else{var o=setTimeout;function i(){}function a(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],d(e,this)}function s(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,a._immediateFn((function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var r;try{r=n(e._value)}catch(e){return void u(t.promise,e)}c(t.promise,r)}else(1===e._state?c:u)(t.promise,e._value)}))):e._deferreds.push(t)}function c(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof a)return e._state=3,e._value=t,void l(e);if("function"==typeof n)return void d((r=n,o=t,function(){r.apply(o,arguments)}),e)}e._state=1,e._value=t,l(e)}catch(t){u(e,t)}var r,o}function u(e,t){e._state=2,e._value=t,l(e)}function l(e){2===e._state&&0===e._deferreds.length&&a._immediateFn((function(){e._handled||a._unhandledRejectionFn(e._value)}));for(var t=0,n=e._deferreds.length;t<n;t++)s(e,e._deferreds[t]);e._deferreds=null}function f(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function d(e,t){var n=!1;try{e((function(e){n||(n=!0,c(t,e))}),(function(e){n||(n=!0,u(t,e))}))}catch(e){if(n)return;n=!0,u(t,e)}}a.prototype.catch=function(e){return this.then(null,e)},a.prototype.then=function(e,t){var n=new this.constructor(i);return s(this,new f(e,t,n)),n},a.all=function(e){var t=Array.prototype.slice.call(e);return new a((function(e,n){if(0===t.length)return e([]);var r=t.length;function o(i,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,(function(e){o(i,e)}),n)}t[i]=a,0==--r&&e(t)}catch(e){n(e)}}for(var i=0;i<t.length;i++)o(i,t[i])}))},a.resolve=function(e){return e&&"object"==typeof e&&e.constructor===a?e:new a((function(t){t(e)}))},a.reject=function(e){return new a((function(t,n){n(e)}))},a.race=function(e){return new a((function(t,n){for(var r=0,o=e.length;r<o;r++)e[r].then(t,n)}))},a._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){o(e,0)},a._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},e.exports=a}},10:e=>{function t(e,t){document.body&&(t.disconnect(),e())}e.exports=function(e){if(document.body)e();else{var n=new MutationObserver((function(){t(e,n)}));n.observe(document.documentElement,{childList:!0,subtree:!0}),t(e,n)}}},390:function(e,t){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){this.name=e,this.version=t,this.os=n};t.BrowserInfo=r;var o=function(e){this.version=e,this.name="node",this.os=process.platform};t.NodeInfo=o;var i=function(){this.bot=!0,this.name="bot",this.version=null,this.os=null};t.BotInfo=i;var a=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/Edg\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],s=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]];function c(e){var t=""!==e&&a.reduce((function(t,n){var r=n[0],o=n[1];if(t)return t;var i=o.exec(e);return!!i&&[r,i]}),!1);if(!t)return null;var o=t[0],s=t[1];if("searchbot"===o)return new i;var c=s[1]&&s[1].split(/[._]/).slice(0,3);return c?c.length<3&&(c=n(c,function(e){for(var t=[],n=0;n<e;n++)t.push("0");return t}(3-c.length))):c=[],new r(o,c.join("."),u(e))}function u(e){for(var t=0,n=s.length;t<n;t++){var r=s[t],o=r[0];if(r[1].test(e))return o}return null}function l(){return"undefined"!=typeof process&&process.version?new o(process.version.slice(1)):null}t.detect=function(e){return e?c(e):"undefined"!=typeof navigator?c(navigator.userAgent):l()},t.parseUserAgent=c,t.detectOS=u,t.getNodeVersion=l},753:function(e,t,n){var r,o,i;!function(a,s){"use strict";o=[n(508)],void 0===(i="function"==typeof(r=function(e){var t=/(^|@)\S+:\d+/,n=/^\s*at .*(\S+:\d+|\(native\))/m,r=/^(eval@)?(\[native code])?$/;return{parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(n))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(t){return t.stack.split("\n").filter((function(e){return!!e.match(n)}),this).map((function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var n=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),r=n.match(/ (\(.+\)$)/);n=r?n.replace(r[0],""):n;var o=this.extractLocation(r?r[1]:n),i=r&&n||void 0,a=["eval","<anonymous>"].indexOf(o[0])>-1?void 0:o[0];return new e({functionName:i,fileName:a,lineNumber:o[1],columnNumber:o[2],source:t})}),this)},parseFFOrSafari:function(t){return t.stack.split("\n").filter((function(e){return!e.match(r)}),this).map((function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===t.indexOf("@")&&-1===t.indexOf(":"))return new e({functionName:t});var n=/((.*".+"[^@]*)?[^@]*)(?:@)/,r=t.match(n),o=r&&r[1]?r[1]:void 0,i=this.extractLocation(t.replace(n,""));return new e({functionName:o,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:t})}),this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)/i,r=t.message.split("\n"),o=[],i=2,a=r.length;i<a;i+=2){var s=n.exec(r[i]);s&&o.push(new e({fileName:s[2],lineNumber:s[1],source:r[i]}))}return o},parseOpera10:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=t.stacktrace.split("\n"),o=[],i=0,a=r.length;i<a;i+=2){var s=n.exec(r[i]);s&&o.push(new e({functionName:s[3]||void 0,fileName:s[2],lineNumber:s[1],source:r[i]}))}return o},parseOpera11:function(n){return n.stack.split("\n").filter((function(e){return!!e.match(t)&&!e.match(/^Error created at/)}),this).map((function(t){var n,r=t.split("@"),o=this.extractLocation(r.pop()),i=r.shift()||"",a=i.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;i.match(/\(([^)]*)\)/)&&(n=i.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var s=void 0===n||"[arguments not available]"===n?void 0:n.split(",");return new e({functionName:a,args:s,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:t})}),this)}}})?r.apply(t,o):r)||(e.exports=i)}()},508:function(e,t){var n,r,o;!function(i,a){"use strict";r=[],void 0===(o="function"==typeof(n=function(){function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}function t(e){return e.charAt(0).toUpperCase()+e.substring(1)}function n(e){return function(){return this[e]}}var r=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],i=["fileName","functionName","source"],a=["args"],s=["evalOrigin"],c=r.concat(o,i,a,s);function u(e){if(e)for(var n=0;n<c.length;n++)void 0!==e[c[n]]&&this["set"+t(c[n])](e[c[n]])}u.prototype={getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof u)this.evalOrigin=e;else{if(!(e instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new u(e)}},toString:function(){var e=this.getFileName()||"",t=this.getLineNumber()||"",n=this.getColumnNumber()||"",r=this.getFunctionName()||"";return this.getIsEval()?e?"[eval] ("+e+":"+t+":"+n+")":"[eval]:"+t+":"+n:r?r+" ("+e+":"+t+":"+n+")":e+":"+t+":"+n}},u.fromString=function(e){var t=e.indexOf("("),n=e.lastIndexOf(")"),r=e.substring(0,t),o=e.substring(t+1,n).split(","),i=e.substring(n+1);if(0===i.indexOf("@"))var a=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(i,""),s=a[1],c=a[2],l=a[3];return new u({functionName:r,args:o||void 0,fileName:s,lineNumber:c||void 0,columnNumber:l||void 0})};for(var l=0;l<r.length;l++)u.prototype["get"+t(r[l])]=n(r[l]),u.prototype["set"+t(r[l])]=function(e){return function(t){this[e]=Boolean(t)}}(r[l]);for(var f=0;f<o.length;f++)u.prototype["get"+t(o[f])]=n(o[f]),u.prototype["set"+t(o[f])]=function(t){return function(n){if(!e(n))throw new TypeError(t+" must be a Number");this[t]=Number(n)}}(o[f]);for(var d=0;d<i.length;d++)u.prototype["get"+t(i[d])]=n(i[d]),u.prototype["set"+t(i[d])]=function(e){return function(t){this[e]=String(t)}}(i[d]);return u})?n.apply(t,r):n)||(e.exports=o)}()},147:e=>{"use strict";e.exports={i8:"13.13.1"}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=n(422);if(e.BV&&e.BV._private){console&&console.warn&&console.warn("BV Loader should only be called once per page.")}else n(612).Z()})()})();
//# sourceURL=https://apps.bazaarvoice.com/bv.js
;/*})'"*/
;/*})'"*/
